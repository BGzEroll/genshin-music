"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[447],{6880:function(e,t,n){n.d(t,{Z:function(){return u}});var r=n(828),a=n(5893),s=n(6042),o=n(3564),i=n(7294),c=n(8949);function u(e){var t,n,u,l=e.children,d=e.page,h=(0,r.Z)((n=(t=(0,r.Z)((0,i.useState)(o.f6),2))[0],u=t[1],(0,i.useEffect)(function(){return(0,c.N7)(o.f6.state.other,function(){u((0,s.Z)({},o.f6))})},[]),[n,u]),1)[0];return(0,a.jsx)("div",{className:"app bg-image",style:{backgroundImage:"url(".concat(h.getOther("backgroundImage"+d),")")},children:l})}},4347:function(e,t,n){n.d(t,{C:function(){return c}});var r=n(828),a=n(5893),s=n(2169),o=n(7294),i=new(n(5839)).ZP,c=(0,o.memo)(function(e){var t=e.chunk,n=e.rows,c=e.hasText,u=e.selected,l=e.theme,d=e.keyboardLayout,h="Genshin"===s.iC?7:5,g=(0,r.Z)((0,o.useState)("var(--primary)"),2),p=g[0],m=g[1];(0,o.useEffect)(function(){m(l.layer("primary",.2).hex())},[l]);var f=Array(h*n).fill(!1);return t.notes.forEach(function(e){f[e.index]=!0}),(0,a.jsx)("div",{className:"frame-outer ".concat(0===t.notes.length?"displayer-ball":""),style:u?{borderColor:"var(--accent)"}:{},children:0===t.notes.length?(0,a.jsx)("div",{}):(0,a.jsx)("div",{className:"displayer-frame",style:{gridTemplateColumns:"repeat(".concat(h,",1fr)")},children:f.map(function(e,t){return(0,a.jsx)("div",{className:e?"frame-note-s":"frame-note-ns",style:e?{}:{backgroundColor:p},children:e&&c?i.getNoteText(t,d,"C"):null},t)})})})},function(e,t){return e.chunk===t.chunk&&e.rows===t.rows&&e.hasText===t.hasText&&e.selected===t.selected&&e.theme===t.theme})},7447:function(e,t,n){n.r(t),n.d(t,{default:function(){return eA}});var r=n(4111),a=n(7568),s=n(1438),o=n(8668),i=n(6042),c=n(9396),u=n(6626),l=n(655),d=n(5893),h=n(7294),g=n(828),p=n(2169),m=n(8376),f=n(2114),y=n(8949),v=n(3564),x=n(3707);function S(){var e=v.f6.get("note_background");return"Genshin"!==p.iC?e.isDark()?p.kx.text.light:p.kx.text.dark:e.luminosity()>.65?p.kx.text.note:e.isDark()?p.kx.text.light:p.kx.text.dark}var k=(0,h.memo)(function(e){var t,n,r=e.note,a=e.approachingNotes,s=e.handleClick,o=e.noteText,c=e.data,u=(0,g.Z)((0,h.useState)(S()),2),l=u[0],k=u[1];(0,h.useEffect)(function(){return(0,y.N7)(v.f6.state.data,function(){k(S())})},[]);var j=(0,x.$d)(r.data),C=c.approachRate,w=c.instrument,N={transition:"background-color ".concat(j.delay,"ms  ").concat(j.delay===("Genshin"===p.iC?100:200)?"ease":"linear"," , transform 0.15s, border-color 100ms")},Z=null===(t=p.as[w])||void 0===t?void 0:t.clickColor;return(0,d.jsxs)("button",{onPointerDown:function(e){e.preventDefault(),s(r)},className:"button-hitbox-bigger",children:[a.map(function(e){return(0,d.jsx)(b,{index:e.index,approachRate:C},e.id)}),0!==j.animationId&&(0,d.jsx)("div",{style:Z&&v.f6.isDefault("accent")?{borderColor:Z}:{},className:p.Al.noteAnimation},j.animationId),(0,d.jsxs)("div",{className:"".concat(p.Al.note," ").concat(function(e){switch(e){case"clicked":return"click-event";case"toClick":return"note-red";case"toClickNext":return"note-border-click";case"toClickAndNext":return"note-red note-border-click";case"approach-wrong":return"click-event approach-wrong";case"approach-correct":return"click-event approach-correct";default:return""}}(r.status)),style:(0,i.Z)({},N,Z&&"clicked"===j.status&&v.f6.isDefault("accent")?{backgroundColor:Z}:{}),children:["Genshin"===p.iC&&(0,d.jsx)(m.Z,{className:"genshin-border",fill:function(e){if("clicked"===e)return"transparent";if("toClickNext"===e||"toClickAndNext"===e)return"#63aea7";var t=v.f6.get("note_background").desaturate(.6);return t.isDark()?t.lighten(.45).hex():t.darken(.18).hex()}(j.status)}),(0,d.jsx)(f.Z,{name:r.noteImage,color:v.f6.isDefault("accent")?null===(n=p.as[w])||void 0===n?void 0:n.fill:void 0,background:"clicked"===j.status?Z&&v.f6.isDefault("accent")?Z:"var(--accent)":"var(--note-background)"}),(0,d.jsx)("div",{className:p.Al.noteName,style:{color:l},children:o})]})]})},function(e,t){return e.note===t.note&&e.data.approachRate===t.data.approachRate&&e.data.instrument===t.data.instrument&&e.handleClick===t.handleClick&&e.noteText===t.noteText&&e.approachingNotes===t.approachingNotes}),b=(0,h.memo)(function(e){var t,n=e.approachRate,r=e.index;return(0,d.jsx)("div",{className:p.Al.approachCircle,style:{animation:"approach ".concat(n,"ms linear"),borderColor:0===(t=Math.floor(r/("Sky"===p.iC?5:7)))?"var(--accent)":1===t?v.f6.get("accent").rotate(180).hex():"var(--accent)"}})},function(e,t){return e.approachRate===t.approachRate&&e.index===t.index}),j=n(2951),C=n(6305),w=function(){function e(){var t=this;(0,s.Z)(this,e),this.state={song:null,playId:0,eventType:"stop",start:0,end:0},this.keyboard=[],this.setKeyboardLayout=function(e){var n;(n=t.keyboard).splice.apply(n,[0,t.keyboard.length].concat((0,C.Z)(e)))},this.resetKeyboardLayout=function(){t.keyboard.forEach(function(e){return e.setState({status:"",delay:"Genshin"===p.iC?100:200})})},this.resetOutgoingAnimation=function(){t.keyboard.forEach(function(e){return e.setState({animationId:0})})},this.setNoteState=function(e,n){t.keyboard[e].setState(n)},this.setState=function(e){Object.assign(t.state,e)},this.play=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"play",end:r,playId:t.state.playId+1})},this.practice=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"practice",end:r,playId:t.state.playId+1})},this.approaching=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;t.setState({song:e,start:n,eventType:"approaching",end:r,playId:t.state.playId+1})},this.resetSong=function(){t.setState({song:null,eventType:"stop",start:0,end:0,playId:0})},this.restartSong=function(e,n){t.setState({start:e,end:n,playId:t.state.playId+1})},(0,y.rC)(this)}return(0,j.Z)(e,[{key:"song",get:function(){return this.state.song}},{key:"eventType",get:function(){return this.state.eventType}},{key:"start",get:function(){return this.state.start}}]),e}();(0,l.__decorate)([y.LO],w.prototype,"state",void 0),(0,l.__decorate)([y.LO],w.prototype,"keyboard",void 0),(0,l.__decorate)([y.aD],w.prototype,"setKeyboardLayout",void 0),(0,l.__decorate)([y.aD],w.prototype,"resetKeyboardLayout",void 0),(0,l.__decorate)([y.aD],w.prototype,"resetOutgoingAnimation",void 0),(0,l.__decorate)([y.aD],w.prototype,"setNoteState",void 0),(0,l.__decorate)([y.aD],w.prototype,"setState",void 0);var N=new w,Z=n(6743),_=n(5453),R=function(){function e(){var t=this;(0,s.Z)(this,e),this.state={position:0,current:0,size:0,end:0},this.pagesState={pages:[],currentPageIndex:0,currentChunkIndex:0,currentPage:[]},this.score={correct:1,wrong:1,score:0,combo:0},this.setSong=function(e){t.setState({size:e.notes.length,position:0,current:0}),t.setPages([])},this.resetScore=function(){t.setScoreState({correct:1,wrong:1,score:0,combo:0})},this.increaseScore=function(e,n){var r=t.score;e?t.setScoreState({correct:r.correct+1,combo:r.combo+1,score:r.score+r.combo*(null!=n?n:1)}):t.setScoreState({wrong:r.wrong+1,combo:0})},this.setPages=function(e){var n,r=e.map(function(e){return e.map(function(e){return e.clone()})});t.setPagesState({pages:r,currentPageIndex:0,currentChunkIndex:0,currentPage:null!==(n=r[0])&&void 0!==n?n:[]})},this.clearPages=function(){t.setPagesState({pages:[],currentPageIndex:0,currentChunkIndex:0,currentPage:[]})},this.setState=function(e){Object.assign(t.state,e)},this.setScoreState=function(e){Object.assign(t.score,e)},this.setPagesState=function(e){Object.assign(t.pagesState,e)},this.setPosition=function(e){t.setState({position:e})},this.incrementCurrent=function(){t.setState({current:t.current+1})},this.incrementChunkPositionAndSetCurrent=function(e){var n,r,a=t.pagesState,s=a.pages,o=a.currentPageIndex;e=null!=e?e:t.current;var i=t.currentChunkIndex+1;if(i>=(null!==(r=null===(n=s[o])||void 0===n?void 0:n.length)&&void 0!==r?r:0)){if(o===s.length-1)return;t.setPagesState({currentPageIndex:o+1,currentChunkIndex:0,currentPage:s[o+1]}),t.setState({current:e})}else t.setPagesState({currentChunkIndex:i}),t.setState({current:e})},this.setCurrent=function(e){t.setState({current:e})},this.setEnd=function(e){t.setState({end:e})},this.setSize=function(e){t.setState({size:e})},(0,y.rC)(this)}return(0,j.Z)(e,[{key:"currentChunkIndex",get:function(){return this.pagesState.currentChunkIndex}},{key:"currentChunk",get:function(){return this.pagesState.currentPage[this.pagesState.currentChunkIndex]}},{key:"position",get:function(){return this.state.position}},{key:"current",get:function(){return this.state.current}},{key:"size",get:function(){return this.state.size}},{key:"end",get:function(){return this.state.end}}]),e}();(0,l.__decorate)([y.LO],R.prototype,"state",void 0),(0,l.__decorate)([y.LO],R.prototype,"pagesState",void 0),(0,l.__decorate)([y.LO],R.prototype,"score",void 0);var P=new R,I=n(539),T=n(2881),L=n(6138),A=n(1328),D=function(e){(0,o.Z)(n,e);var t=(0,u.Z)(n);function n(e){(0,s.Z)(this,n),(d=t.call(this,e)).approachRate=1500,d.approachingNotesList=[],d.nextChunkDelay=0,d.tickTime=50,d.tickInterval=0,d.songTimestamp=0,d.toDispose=[],d.timeouts=[],d.debouncedStateUpdate=0,d.handleMidi=function(e){var t=(0,g.Z)(e,3),n=t[0],r=t[1],a=t[2];if(d.mounted){var s=d.props.data.instrument;L.mP.isDown(n)&&0!==a&&L.mP.settings.notes.filter(function(e){return e.midi===r}).forEach(function(e){d.handleClick(s.notes[e.index])})}};var o,i,c,u,d,h=(0,r.Z)(d);d.handleKeyboard=(o=(0,a.Z)(function(e){var t,n,r;return(0,l.__generator)(this,function(a){return t=e.letter,n=e.shift,e.event.repeat||n||null===(r=h.props.data.instrument.getNoteFromCode(t))||h.handleClick(r),[2]})}),function(e){return o.apply(this,arguments)});var m=(0,r.Z)(d);d.approachingSong=(i=(0,a.Z)(function(e){var t,n,r,a,s,o,i,c,u,d=arguments;return(0,l.__generator)(this,function(l){for(t=d.length>1&&void 0!==d[1]?d[1]:0,n=(n=d.length>2?d[2]:void 0)||e.notes.length,r=m.props.data.speedChanger,a=[],m.approachRate=m.props.data.approachRate||1500,s=m.approachRate,o=void 0!==e.notes[t]?e.notes[t].time:0,i=t;i<n&&i<e.notes.length;i++)c=e.notes[i],u=new I.Yy({time:Math.floor((c.time-o)/r.value+s),index:c.index}),a.push(u);return P.setSong(e),P.clearPages(),P.resetScore(),m.setState({approachingNotes:Z.N3.from("Sky"===p.iC?15:21)}),m.approachingNotesList=a,[2]})}),function(e){return i.apply(this,arguments)}),d.tick=function(){if(d.props.data.hasSong){var e=d.state.approachingNotes,t=d.props.data.speedChanger,n=d.approachingNotesList;n.forEach(function(e){e.time-=d.tickTime});for(var r=!1,a=0,s=0;s<n.length;s++)if(n[s].time<d.approachRate){var o=new I.Yy({time:d.approachRate,index:n[s].index,id:Math.floor(1e4*Math.random())});e[n[s].index].push(o),n.splice(s,1),s--,r=!0}else break;e.forEach(function(e){for(var n=0;n<e.length;n++){var s=e[n];s.time-=d.tickTime,s.clicked&&(s.time<d.approachRate/3?P.increaseScore(!0,t.value):P.increaseScore(!1),s.time=-1),s.time<0&&(s.clicked||P.increaseScore(!1),e.splice(n,1),n--,r=!0,a++)}}),r&&(P.setCurrent(P.current+a),d.setState({approachingNotes:e.map(function(e){return e.slice()})}))}};var f=(0,r.Z)(d);d.playSong=(c=(0,a.Z)(function(e){var t,n,r,a,s,o,i,c,u,d,h,g,p,m,y=arguments;return(0,l.__generator)(this,function(l){switch(l.label){case 0:return t=y.length>1&&void 0!==y[1]?y[1]:0,n=(n=y.length>2?y[2]:void 0)||e.notes.length,f.songTimestamp=e.timestamp,r=f.state.keyboard,a=f.applySpeedChange(e.notes).slice(t,n),s=T.M.mergeNotesIntoChunks(a.map(function(e){return e.clone()})),P.setPages((0,Z.YY)(s,10)),[4,(0,Z.gw)(200)];case 1:l.sent(),i=o=a[0].time,c=0,u=Date.now(),d=0,h=0,l.label=2;case 2:if(!(h<a.length))return[3,6];if(p=a[h].time-i,i=a[h].time,!(p>16))return[3,4];return[4,(0,Z.gw)(p+c)];case 3:l.sent(),l.label=4;case 4:if(!f.mounted||f.songTimestamp!==e.timestamp)return[2];f.handleClick(r[a[h].index],a[h].layer),d>=(null!==(m=null===(g=P.currentChunk)||void 0===g?void 0:g.notes.length)&&void 0!==m?m:0)?(d=1,P.incrementChunkPositionAndSetCurrent(t+h+1)):(d++,P.setCurrent(t+h+1)),c=u+i-o-Date.now(),l.label=5;case 5:return h++,[3,2];case 6:return[2]}})}),function(e){return c.apply(this,arguments)}),d.applySpeedChange=function(e){var t=d.props.data.speedChanger;return e.map(function(e){return e.time=e.time/t.value,e})},d.practiceSong=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;n=n||e.notes.length;var r=d.state.keyboard,a=d.applySpeedChange(e.notes).slice(t,n),s=T.M.mergeNotesIntoChunks(a.map(function(e){return e.clone()}));if(0!==s.length){d.nextChunkDelay=0,s[0].notes.forEach(function(e){N.setNoteState(e.index,{status:"toClick",delay:"Genshin"===p.iC?100:200})});var o=s[1];null==o||o.notes.forEach(function(e){var t=r[e.index];if("toClick"===t.status)return t.setStatus("toClickAndNext");t.setStatus("toClickNext")}),d.props.functions.setHasSong(!0),P.setPages((0,Z.YY)(s,10)),d.setState({songToPractice:s})}};var y=(0,r.Z)(d);return d.restartSong=(u=(0,a.Z)(function(e){return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,y.stopSong()];case 1:if(t.sent(),!y.mounted)return[2];return N.restartSong("number"==typeof e?e:P.position,P.end),[2]}})}),function(e){return u.apply(this,arguments)}),d.stopSong=function(){return d.songTimestamp=0,new Promise(function(e){N.resetKeyboardLayout(),d.approachingNotesList=[],d.setState({songToPractice:[],approachingNotes:Z.N3.from("Sky"===p.iC?15:21)},e),d.props.functions.setHasSong(!1)})},d.stopAndClear=function(){d.stopSong(),N.resetSong()},d.handleApproachClick=function(e){var t=d.state.approachingNotes[e.index][0];return t&&(t.clicked=!0,t.time<d.approachRate/3)?"approach-correct":"approach-wrong"},d.handlePracticeClick=function(e){var t=d.state,n=t.keyboard,r=t.songToPractice;if(r.length>0){var a,s=null===(a=r[0])||void 0===a?void 0:a.notes.findIndex(function(t){return t.index===e.index});if(-1!==s){if(r[0].notes.splice(s,1),0===r[0].notes.length&&(r.shift(),P.incrementChunkPositionAndSetCurrent()),r.length>0){var o=r[0],i=r[1];o.notes.forEach(function(e){N.setNoteState(e.index,{status:"toClick",delay:o.delay})}),i&&(null==i||i.notes.forEach(function(e){var t=n[e.index];if("toClick"===t.status)return t.setStatus("toClickAndNext");t.setStatus("toClickNext")}))}P.incrementCurrent(),d.setState({songToPractice:r})}}},d.handleClick=function(e,t){var n=d.state.keyboard,r=d.props.data.hasAnimation;if(e){var a=n[e.index].status;N.setNoteState(e.index,{status:"clicked",delay:"play"!==N.eventType?"Genshin"===p.iC?100:200:0,animationId:r&&"approaching"!==N.eventType?Math.floor(1e4*Math.random())+Date.now():0}),d.handlePracticeClick(e),d.props.functions.playSound(e.index,t);var s=d.handleApproachClick(e);"approaching"===N.eventType&&(N.setNoteState(e.index,{status:s}),"approach-wrong"===s&&P.increaseScore(!1)),d.timeouts[e.index]>0&&"play"===N.eventType&&clearTimeout(d.timeouts[e.index]),d.timeouts[e.index]=setTimeout(function(){if(d.timeouts[e.index]=0,["clicked","approach-wrong","approach-correct"].includes(n[e.index].status)){if("toClickNext"===a)return N.setNoteState(e.index,{status:a});N.setNoteState(e.index,{status:""})}},"Sky"===p.iC?200:100)}},d.state={playTimestamp:Date.now(),songToPractice:[],approachingNotes:Z.N3.from("Sky"===p.iC?15:21),keyboard:N.keyboard},d.mounted=!0,d}var h=n.prototype;return h.componentDidMount=function(){var e=this,t="keyboard-player";this.tickInterval=setInterval(this.tick,this.tickTime),A.w.registerLetter("S",function(){e.props.data.hasSong&&e.stopAndClear()},{shift:!0,id:t}),A.w.registerLetter("R",function(){e.props.data.hasSong&&["practice","play","approaching"].includes(N.eventType)&&e.restartSong(0)},{shift:!0,id:t}),A.w.listen(this.handleKeyboard,{id:t}),L.mP.addListener(this.handleMidi);var n=this;this.toDispose.push((0,x.VZ)(N.state,(0,a.Z)(function(){return(0,l.__generator)(this,function(e){return n.debouncedStateUpdate&&clearTimeout(n.debouncedStateUpdate),n.debouncedStateUpdate=setTimeout((0,a.Z)(function(){var e,t,r,a,s,o,i;return(0,l.__generator)(this,function(c){switch(c.label){case 0:return e=N.state,t=N.song,r=N.eventType,[4,n.stopSong()];case 1:if(c.sent(),!n.mounted)return[2];if("stop"===r)n.props.functions.setHasSong(!1);else{if(!t)return[2];(o=t.isComposed?t.toRecordedSong().clone():t.clone()).timestamp=Date.now(),i=e.end||(null==o?void 0:null===(a=o.notes)||void 0===a?void 0:a.length)||0,"play"===r&&n.playSong(o,e.start,i),"practice"===r&&n.practiceSong(o,e.start,i),"approaching"===r&&n.approachingSong(o,e.start,i),n.props.functions.setHasSong(!0),_.Z.songEvent({type:r}),P.setState({size:(null==o?void 0:null===(s=o.notes)||void 0===s?void 0:s.length)||1,position:e.start,end:i,current:e.start})}return[2]}})}),4),[2]})}))),this.toDispose.push((0,x.wo)(N.keyboard,function(){e.setState({keyboard:N.keyboard})}))},h.componentWillUnmount=function(){L.mP.removeListener(this.handleMidi),this.toDispose.forEach(function(e){return e()}),A.w.unregisterById("keyboard-player"),this.songTimestamp=0,N.resetSong(),this.mounted=!1,clearInterval(this.tickInterval)},h.render=function(){var e=this,t=this.state,n=this.props.data,r=n.instrument,a=n.noteNameType,s=n.pitch,o=t.keyboard,u=(0,Z.uZ)(n.keyboardSize/100,.5,1.5),l="keyboard"+("play"===N.eventType?" keyboard-playback":"");return 15===o.length&&(l+=" keyboard-5"),14===o.length&&(l+=" keyboard-5"),8===o.length&&(l+=" keyboard-4"),6===o.length&&(l+=" keyboard-3"),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{className:l,style:(0,c.Z)((0,i.Z)({},1!==u?{transform:"scale(".concat(u,")")}:{}),{zIndex:2,marginBottom:"".concat(6*u+n.keyboardYPosition/10,"vh")}),children:n.isLoading?(0,d.jsx)("div",{className:"loading",children:"Loading..."}):o.map(function(n){return(0,d.jsx)(k,{note:n,data:{approachRate:e.approachRate,instrument:r.name},approachingNotes:t.approachingNotes[n.index],handleClick:e.handleClick,noteText:r.getNoteText(n.index,a,s)},n.index)})})})},n}(h.Component),M=n(9583),E=n(9352),z=n(8826),V=n(7671),O=n(781),F=n(7362),H=n(4339),Y=n(1182);function B(e){var t,n,r=e.onClick,s=e.data,o=e.importSong,i=e.theme,c=(0,g.Z)((0,h.useState)(!1),2),u=c[0],p=c[1],m=(0,g.Z)((0,h.useState)(null),2),f=m[0],y=m[1],v=(t=(0,a.Z)(function(){var e,t;return(0,l.__generator)(this,function(n){switch(n.label){case 0:if(u)return[2];n.label=1;case 1:if(n.trys.push([1,3,,4]),f)return[2,o(f.clone())];return p(!0),[4,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(s.file)).then(function(e){return e.json()})];case 2:return e=n.sent(),p(!1),y(e=Y.v.parseSong(e)),o(e),[3,4];case 3:return t=n.sent(),p(!1),console.error(t),H.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(){return t.apply(this,arguments)}),x=(n=(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:if(u)return[2];t.label=1;case 1:if(t.trys.push([1,3,,4]),f)return[2,r(f,0)];return p(!0),[4,fetch("https://sky-music.herokuapp.com/api/songs?get="+encodeURI(s.file)).then(function(e){return e.json()})];case 2:return e=t.sent(),p(!1),r(e=Y.v.parseSong(e),0),y(e),[3,4];case 3:return console.error(t.sent()),p(!1),H.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(){return n.apply(this,arguments)});return(0,d.jsxs)("div",{className:"song-row",children:[(0,d.jsx)("div",{className:"song-name",onClick:x,children:s.name}),(0,d.jsx)("div",{className:"song-buttons-wrapper",children:(0,d.jsx)("button",{className:"song-button",onClick:v,"aria-label":"Import song ".concat(s.name),style:{backgroundColor:i.layer("primary",.2).hex(),marginRight:0},children:u?(0,d.jsx)(M.fCD,{}):(0,d.jsx)(M.aBF,{})})})]})}var K=n(9878),U=n(2809),J=n(8461),G=n(125),Q=n(1664),W=n.n(Q),$=n(8778),X=n(5055),q=n(1446),ee=n(1014),et=n(515),en=n(1108),er=n(2452),ea=n(750),es=n(1866),eo=n(2650),ei=n(4931),ec=n(8434),eu=n(7008),el=n(7053),ed=n(2132),eh=n(5272),eg=n(5684),ep=["vsrg"];function em(e){var t,n=e.data,r=e.functions,s=e.theme,o=e.folders,i=r.removeSong,c=r.toggleMenu,u=r.downloadSong,p=r.renameSong,m={backgroundColor:s.layer("primary",.15).hex()},f=(0,g.Z)((0,h.useState)(!1),2),y=f[0],v=f[1],x=(0,g.Z)((0,h.useState)(n.name),2),S=x[0],k=x[1];return((0,h.useEffect)(function(){k(n.name)},[n.name]),"vsrg"===n.type)?(0,d.jsx)("div",{className:"row",children:"Invalid song"}):(0,d.jsxs)("div",{className:"song-row",children:[(0,d.jsxs)("div",{className:"song-name ".concat((0,ee.h)(!0)),onClick:(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:if(y)return[2];return e=N.play,[4,Y.v.fromStorableSong(n)];case 1:return e.apply(N,[t.sent(),0]),c(!1),[2]}})}),children:[y?(0,d.jsx)("input",{className:"song-name-input ".concat(y?"song-rename":""),disabled:!y,onChange:function(e){return k(e.target.value)},style:{width:"100%",color:"var(--primary-text)"},value:S}):(0,d.jsx)("div",{style:{marginLeft:"0.3rem"},children:S}),(0,d.jsx)(ee.u,{children:y?"Song name":"Play song"})]}),(0,d.jsxs)("div",{className:"song-buttons-wrapper",children:[(0,d.jsx)(K.v,{onClick:(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,Y.v.fromStorableSong(n)];case 1:return e=t.sent(),N.practice(e,0,e.notes.length),c(!1),[2]}})}),ariaLabel:"Practice song ".concat(n.name),tooltip:"Practice",style:m,children:(0,d.jsx)(M.Xe,{})}),(0,d.jsx)(K.v,{onClick:(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,Y.v.fromStorableSong(n)];case 1:return e=t.sent(),N.approaching(e,0,e.notes.length),c(!1),[2]}})}),tooltip:"Approach mode",ariaLabel:"Play in Approach mode the song ".concat(n.name),style:m,children:(0,d.jsx)(M.muy,{})}),(0,d.jsxs)(en.Rk,{Icon:M.LCi,style:m,ignoreClickOutside:y,tooltip:"More options",onClose:function(){return v(!1)},children:[(0,d.jsxs)(en.tc,{onClick:function(){y&&(p(S,n.id),v(!1)),v(!y)},children:[(0,d.jsx)(M.tU3,{style:{marginRight:"0.4rem"},size:14}),(0,d.jsx)(en.Qr,{text:y?"Save":"Rename"})]}),(0,d.jsxs)(en.tc,{style:{padding:"0 0.4rem"},children:[(0,d.jsx)(M.$nz,{style:{marginRight:"0.4rem"}}),(0,d.jsxs)("select",{className:"dropdown-select",value:n.folderId||"_None",onChange:(t=(0,a.Z)(function(e){var t,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:return t=e.target.value,[4,Y.v.getOneSerializedFromStorable(n)];case 1:if(!(r=a.sent()))return[2,H.kg.error("Could not find song")];return eo.k.addSongToFolder(r,"_None"!==t?t:null),[2]}})}),function(e){return t.apply(this,arguments)}),children:[(0,d.jsx)("option",{value:"_None",children:"None"}),o.map(function(e){return(0,d.jsx)("option",{value:e.id,children:e.name},e.id)})]})]}),(0,d.jsx)(W(),{href:{pathname:"composer",query:{songId:n.id}},style:{width:"100%"},children:(0,d.jsxs)(en.tc,{style:{width:"100%"},onClick:function(){(null==n?void 0:n.type)==="recorded"&&H.kg.warn("Converting recorded song to composed, audio might not be accurate")},children:[(0,d.jsx)(M.fmQ,{style:{marginRight:"0.4rem"},size:14}),(0,d.jsx)(en.Qr,{text:"Edit song"})]})}),(0,d.jsxs)(en.tc,{onClick:(0,a.Z)(function(){return(0,l.__generator)(this,function(e){switch(e.label){case 0:return[4,Y.v.fromStorableSong(n)];case 1:return u(e.sent()),[2]}})}),children:[(0,d.jsx)(M.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,d.jsx)(en.Qr,{text:"Download"})]}),(0,d.jsxs)(en.tc,{onClick:(0,a.Z)(function(){return(0,l.__generator)(this,function(e){switch(e.label){case 0:return[4,Y.v.fromStorableSong(n)];case 1:return u(e.sent().toMidi()),[2]}})}),children:[(0,d.jsx)(M.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,d.jsx)(en.Qr,{text:"Download MIDI"})]}),(0,d.jsxs)(en.tc,{onClick:function(){return i(n.name,n.id)},children:[(0,d.jsx)(M.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"},size:14}),(0,d.jsx)(en.Qr,{text:"Delete"})]})]})]})]})}var ef=function(e){var t,n,r,s=e.functions,o=e.data,i=function(){b(""),I(""),Z([])},c=(0,g.Z)((0,eu.n)(),1)[0],u=(0,g.Z)((0,h.useState)(!1),2),m=u[0],f=u[1],y=(0,g.Z)((0,h.useState)("Songs"),2),v=y[0],x=y[1],S=(0,g.Z)((0,h.useState)(""),2),k=S[0],b=S[1],j=(0,g.Z)((0,h.useState)([]),2),w=j[0],Z=j[1],R=(0,g.Z)((0,h.useState)(""),2),P=R[0],I=R[1],L=(0,g.Z)((0,h.useState)(!1),2),D=L[0],K=L[1],Q=(0,g.Z)((0,X.F)(),1)[0],en=(0,g.Z)((0,ei.j)(),1)[0],eo=s.handleSettingChange,ef=s.addSong,ey=s.removeSong,ev=s.renameSong,ex=(0,el.ZP)(function(e){f(!1)},{active:m,ignoreFocusable:!0});(0,h.useEffect)(function(){function e(){return(e=(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:if(!(navigator.storage&&navigator.storage.persist))return[3,4];return[4,navigator.storage.persisted()];case 1:if(e=t.sent())return[3,3];return[4,navigator.storage.persist()];case 2:e=t.sent(),t.label=3;case 3:K(e),t.label=4;case 4:return[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[]);var eS=(0,h.useCallback)(function(e){var t,n=e.letter,r=e.shift,a=e.code;null===(t=document.activeElement)||void 0===t||t.blur(),"M"===n&&r&&f(!m),"Escape"===a&&f(!1)},[m]);(0,h.useEffect)(function(){return A.w.listen(eS),function(){return A.w.unlisten(eS)}},[eS]);var ek=(t=(0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:if("Searching..."===P)return[2];if(0===k.trim().length)return[2,I("Please write a non empty name")];return I("Searching..."),[4,fetch("https://sky-music.herokuapp.com/api/songs?search="+encodeURI(k)).then(function(e){return e.json()})];case 1:if((e=t.sent()).error)return I("Please write a non empty name"),[2,H.kg.error(e.error)];return I("success"),Z(e),_.Z.songSearch({name:k}),[2]}})}),function(){return t.apply(this,arguments)}),eb=function(e){"boolean"!=typeof e&&(e=null),f(null!==e?e:!m)},ej=function(e){if(e===v&&m)return f(!1);i(),e&&x(e),f(!0),_.Z.UIEvent("menu",{tab:e})},eC=(n=(0,a.Z)(function(e){var t,n,r,a,s,o,i,c,u,d;return(0,l.__generator)(this,function(l){switch(l.label){case 0:t=!0,n=!1,r=void 0,l.label=1;case 1:l.trys.push([1,8,9,10]),a=e[Symbol.iterator](),l.label=2;case 2:if(t=(s=a.next()).done)return[3,7];o=s.value,l.label=3;case 3:return l.trys.push([3,5,,6]),i=Array.isArray(o.data)?o.data:[o.data],[4,ed.bV.importAndLog(i)];case 4:return l.sent(),[3,6];case 5:if(console.error(l.sent()),null===(u=(c=o.file.name).includes)||void 0===u?void 0:u.call(c,".mid"))return[2,H.kg.error("Midi files should be imported in the composer")];return eZ(),[3,6];case 6:return t=!0,[3,2];case 7:return[3,10];case 8:return d=l.sent(),n=!0,r=d,[3,10];case 9:try{t||null==a.return||a.return()}finally{if(n)throw r}return[7];case 10:return[2]}})}),function(e){return n.apply(this,arguments)}),ew=(r=(0,a.Z)(function(e){var t,n;return(0,l.__generator)(this,function(r){switch(r.label){case 0:if(!(e instanceof er.Midi))return[3,2];return[4,(0,ea.jH)("If you use MIDI, the song will loose some information, if you want to share the song with others, use the other format (button above). Do you still want to download?")];case 1:if(!r.sent())return[2];return[2,ed.bV.downloadMidi(e)];case 2:return t=e.name,n=["Sky"===p.iC?e.toOldFormat():e.serialize()],ed.bV.downloadSong(n,"".concat(t,".").concat(p.iC.toLowerCase(),"sheet")),H.kg.success("Song downloaded"),_.Z.userSongs("download",{name:t,page:"player"}),[2]}})}),function(e){return r.apply(this,arguments)}),eN=(0,h.useCallback)((0,a.Z)(function(){var e;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,(0,ea.cJ)("Write the folder name")];case 1:if(!(e=t.sent()))return[2];return ec.p.createFolder(e),[2]}})}),[]),eZ=(0,h.useCallback)(function(e){e&&console.error(e),H.kg.error("Error importing file, invalid format",8e3)},[]);function e_(){return(e_=(0,a.Z)(function(){var e,t,n,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,Y.v.getSongs()];case 1:return e=a.sent().map(function(e){if("Sky"===p.iC){if("composed"===e.type)return $.l.deserialize(e).toOldFormat();if("recorded"===e.type)return T.M.deserialize(e).toOldFormat()}return e}),t=new Date().toISOString().split("T")[0],[4,eh.b.getFolders()];case 2:return n=a.sent(),r=(0,C.Z)(n).concat((0,C.Z)(e)),ed.bV.downloadFiles(r,"".concat(p.iC,"_Backup_").concat(t)),H.kg.success("Song backup downloaded"),eg.j.setLastBackupWarningTime(Date.now()),[3,4];case 3:return console.error(a.sent()),H.kg.error("Error downloading songs"),[3,4];case 4:return[2]}})})).apply(this,arguments)}var eR=Q.layer("menu_background",.35).lighten(.2),eP=Q.layer("menu_background",.32).desaturate(.4);return(0,d.jsxs)("div",{className:"menu-wrapper",ref:ex,children:[(0,d.jsxs)("div",{className:"menu menu-visible menu-main-page",children:[m&&(0,d.jsx)(V.s,{onClick:eb,className:"close-menu",ariaLabel:"Close menu",children:(0,d.jsx)(M.aHS,{className:"icon"})}),(0,d.jsx)(V.s,{onClick:function(){return ej("Help")},className:"margin-top-auto",isActive:"Help"===v&&m,ariaLabel:"Open info menu",children:(0,d.jsx)(M.LL$,{className:"icon"})}),(0,d.jsx)(V.s,{onClick:function(){return ej("Library")},isActive:"Library"===v&&m,ariaLabel:"Open library menu",children:(0,d.jsx)(E.voH,{className:"icon"})}),(0,d.jsx)(V.s,{onClick:function(){return ej("Songs")},isActive:"Songs"===v&&m,ariaLabel:"Open songs menu",children:(0,d.jsx)(M.HcQ,{className:"icon"})}),(0,d.jsx)(V.s,{onClick:function(){return ej("Settings")},isActive:"Settings"===v&&m,ariaLabel:"Open settings",children:(0,d.jsx)(M.p4t,{className:"icon"})}),(0,d.jsx)(V.s,{onClick:U.I.open,ariaLabel:"Open home menu",children:(0,d.jsx)(M.xng,{className:"icon"})})]}),(0,d.jsxs)("div",{className:m?"side-menu menu-open":"side-menu",children:[(0,d.jsx)(O.Z,{title:"No selection",current:v,id:"No selection"}),(0,d.jsxs)(O.Z,{current:v,id:"Songs",children:[(0,d.jsxs)("div",{className:"songs-buttons-wrapper",children:[(0,d.jsx)(et.k,{children:(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:"Click the song name to play it"}),(0,d.jsx)("li",{children:"You can import songs made by other users (does not accept audio files). Or you can download yours to share"}),(0,d.jsx)("li",{children:"To create your song, you can record the notes you play or create one in the composer"}),(0,d.jsxs)("li",{children:[(0,d.jsx)(M.Xe,{style:{marginRight:"0.2rem"}}),": Start the practice mode"]}),(0,d.jsxs)("li",{children:[(0,d.jsx)(M.muy,{style:{marginRight:"0.2rem"}}),": Start the approaching notes mode"]}),p.DR&&(0,d.jsx)("li",{children:"You can connect a MIDI keyboard to play"})]})}),(0,d.jsx)(W(),{href:"composer",style:{marginLeft:"auto"},children:(0,d.jsx)(J.J,{children:"Compose song"})}),(0,d.jsx)(q.G,{onPick:eC,onError:eZ,as:"json",multiple:!0,children:(0,d.jsx)(J.J,{children:"Import song sheet"})})]}),(0,d.jsx)(G.G,{songs:c,exclude:ep,style:{marginTop:"0.6rem"},SongComponent:em,componentProps:{theme:Q,folders:en,functions:{removeSong:ey,toggleMenu:eb,downloadSong:ew,renameSong:ev}}}),(0,d.jsx)("div",{className:"row",style:{justifyContent:"flex-end"},children:(0,d.jsx)(J.J,{onClick:eN,children:"Create folder"})}),(0,d.jsx)("div",{style:{marginTop:"auto",paddingTop:"0.5rem",width:"100%",display:"flex",justifyContent:"flex-end"},children:(0,d.jsx)(J.J,{style:{marginLeft:"auto"},onClick:function(){return e_.apply(this,arguments)},children:"Download all songs (backup)"})})]}),(0,d.jsxs)(O.Z,{current:v,id:"Settings",children:[(0,d.jsx)(es.A,{settings:o.settings,changeVolume:s.changeVolume,onUpdate:eo}),(0,d.jsxs)("div",{className:"settings-row-wrap",children:[p.DR&&(0,d.jsx)(W(),{href:"midi-setup",children:(0,d.jsx)(J.J,{style:{width:"fit-content"},children:"Connect MIDI keyboard"})}),(0,d.jsx)(W(),{href:"theme",children:(0,d.jsx)(J.J,{style:{width:"fit-content"},children:"Change app theme"})})]}),(0,d.jsxs)("div",{style:{marginTop:"0.4rem",marginBottom:"0.6rem"},className:(0,ee.h)(!0),children:[D?"Storage is persisted":"Storage is not persisted",D?(0,d.jsx)(ee.u,{position:"top",style:{maxWidth:"unset"},children:"Your data is persisted in the browser, the browser should not automatically clear it. Always make sure to download a backup sometimes, especially when you will not use the app for a long time"}):(0,d.jsx)(ee.u,{position:"top",children:"The browser didn't allow to store data persistently, it might happen that you will loose data when cache is automatically cleared. To get persistent storage, add the app to the home screen. If that still doesn't work, make sure you do a backup often"})]}),(0,d.jsx)(F.Z,{})]}),(0,d.jsxs)(O.Z,{title:"Library",current:v,id:"Library",children:[(0,d.jsx)("div",{children:"Here you can find songs to learn, they are provided by the sky-music library."}),(0,d.jsxs)("div",{className:"library-search-row",children:[(0,d.jsx)("input",{className:"library-search-input",style:{backgroundColor:eR.toString()},placeholder:"Song name",onKeyDown:function(e){"Enter"===e.code&&ek()},onInput:function(e){return b(e.target.value)},value:k}),(0,d.jsx)("button",{className:"library-search-btn",onClick:i,style:{backgroundColor:eR.toString()},children:(0,d.jsx)(M.aHS,{})}),(0,d.jsx)("button",{className:"library-search-btn",onClick:ek,style:{backgroundColor:eR.toString()},children:(0,d.jsx)(M.U41,{})})]}),(P||w.length>0)&&(0,d.jsx)("div",{className:"library-search-songs-wrapper",style:{backgroundColor:eP.toString()},children:"success"===P?w.length>0?w.map(function(e){return(0,d.jsx)(B,{theme:Q,data:e,importSong:ef,onClick:N.play},e.file)}):(0,d.jsx)("div",{className:"library-search-result-text",children:"No results"}):(0,d.jsx)("div",{className:"library-search-result-text",children:P})})]}),(0,d.jsxs)(O.Z,{title:"Help",current:v,id:"Help",children:[(0,d.jsxs)("div",{className:"help-icon-wrapper",children:[(0,d.jsx)("a",{href:"https://discord.gg/Arsf65YYHq",children:(0,d.jsx)(M.j2d,{className:"help-icon"})}),(0,d.jsx)("a",{href:"https://github.com/Specy/genshin-music",children:(0,d.jsx)(M.hJX,{className:"help-icon"})})]}),(0,d.jsx)(z.p,{}),(0,d.jsx)(F.Z,{})]})]})]})},ey=n(5839),ev=n(9788),ex=n(7557),eS=n(4995),ek=n(657),eb=n(9218),ej=n(3337),eC=n(9731),ew=n(3750),eN=(0,h.memo)(function(){var e=(0,x.$d)(P.state),t=(0,g.Z)((0,h.useState)(null),2),n=t[0],r=t[1],a=(0,g.Z)((0,h.useState)(p.n),2),s=a[0],o=a[1],i=(0,h.useRef)(null),c=(0,h.useRef)(null),u=(0,h.useRef)(null);(0,h.useEffect)(function(){var e=function(){null!==n&&r(null)};if(null!==n)return window.addEventListener("pointerup",e),window.addEventListener("blur",e),function(){window.removeEventListener("pointerup",e),window.removeEventListener("blur",e)}},[n]);var l=function(t,r){if(null!==n||r){var a=s.height,o=s.y,i=t.clientY-o,c=(0,Z.uZ)(Math.round((1-i/a)*e.size),0,e.size);"start"===(r||n)?c-e.end<-1&&P.setPosition(c):c-e.position>1&&P.setState({end:c})}},m=0!==e.size?e.position/e.size*100:0,f=0!==e.size?e.end/e.size*100:100;return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)("div",{className:"slider-outer",ref:u,onPointerUp:function(){r(null)},onPointerMove:l,onPointerDown:function(e){if(u.current&&i.current&&c.current){var t=u.current.getBoundingClientRect(),n=e.clientY,a=i.current.getBoundingClientRect().y,s=c.current.getBoundingClientRect().y,d=Math.abs(a-n),h=Math.abs(s-n);o(t),r(d>=h?"end":"start"),l(e,d>=h?"end":"start")}},children:[(0,d.jsx)("div",{className:"slider-full",children:(0,d.jsx)("div",{className:"slider-current",style:{transform:"translateY(".concat((100-e.current/e.size*100).toFixed(1),"%)")}})}),(0,d.jsxs)("div",{className:"two-way-slider",children:[(0,d.jsxs)("div",{className:"two-way-slider-thumb",style:{bottom:"calc(".concat(f,"% - 18px)")},ref:c,children:[(0,d.jsx)("div",{style:{fontSize:"0.8rem"},children:e.end}),(0,d.jsx)(eb.Z,{children:(0,d.jsx)(ew.Ejc,{width:16,style:{filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 2px 2px)"}})})]}),(0,d.jsxs)("div",{className:"two-way-slider-thumb",style:{bottom:"calc(".concat(m,"% - 14px)")},ref:i,children:[(0,d.jsx)("div",{style:{fontSize:"0.8rem"},children:e.position}),(0,d.jsx)(eb.Z,{children:(0,d.jsx)(ew.Ejc,{width:16,style:{filter:"drop-shadow(rgba(0, 0, 0, 0.4) 0px 2px 2px)"}})})]})]})]})})},function(){return!0}),eZ=n(4347),e_="Genshin"===p.iC?"Keyboard layout":"ABC",eR=(0,h.memo)(function(){var e,t=(0,x.$d)(P.pagesState),n=(0,g.Z)((0,X.F)(),1)[0];return(0,d.jsx)(d.Fragment,{children:t.pages.length>0&&(0,d.jsx)("div",{className:"player-chunks-page",children:null===(e=t.currentPage)||void 0===e?void 0:e.map(function(e,r){return(0,d.jsx)(eZ.C,{keyboardLayout:e_,theme:n,selected:r===t.currentChunkIndex,chunk:e,rows:3,hasText:!1},r)})})})},function(){return!0}),eP=(0,h.memo)(function(e){var t=e.onRestart,n=e.onRawSpeedChange,r=e.speedChanger,a=e.hasSong,s=e.isMetronomePlaying,o=e.onToggleMetronome,i=e.isRecordingAudio,c=e.onToggleRecordAudio,u=e.isVisualSheetVisible,l=(0,x.$d)(N.state);return(0,d.jsxs)(d.Fragment,{children:["approaching"===l.eventType&&(0,d.jsx)(eI,{}),(0,d.jsxs)("div",{className:"column player-right-controls",children:[(0,d.jsx)("div",{children:"approaching"!==l.eventType&&(0,d.jsx)(J.J,{toggled:i,onClick:function(){return c(!i)},children:i?"Finish recording":"Record audio"})}),(0,d.jsxs)("div",{className:"slider-wrapper column",style:a?{}:{display:"none"},children:[(0,d.jsxs)("div",{className:"row",style:{width:"100%"},children:[(0,d.jsxs)("div",{className:"".concat((0,ee.h)(!0)," row"),style:{marginRight:"0.4rem",flex:1},children:[(0,d.jsxs)("select",{className:"slider-select",onChange:n,value:r.name,style:{backgroundImage:"none"},children:[(0,d.jsx)("option",{disabled:!0,children:"Speed"}),p.Qk.map(function(e){return(0,d.jsx)("option",{value:e.name,children:e.name},e.name)})]}),(0,d.jsx)(ee.u,{position:"left",children:"Change speed"})]}),(0,d.jsx)(ej.h,{onClick:function(){N.resetSong(),P.clearPages(),P.resetScore()},style:{flex:1},tooltip:"Stop",ariaLabel:"Stop song",children:(0,d.jsx)(eb.Z,{children:(0,d.jsx)(M.JuG,{})})})]}),(0,d.jsx)(eN,{}),(0,d.jsx)(ej.h,{onClick:t,tooltip:"Restart",ariaLabel:"Restart song",children:(0,d.jsx)(eb.Z,{children:(0,d.jsx)(M.dnK,{})})})]}),(0,d.jsx)(ej.h,{toggled:s,onClick:o,className:"metronome-button",ariaLabel:"Toggle metronome",children:(0,d.jsx)(eC.eHT,{size:22})})]}),u&&(0,d.jsx)(eR,{})]})},function(e,t){return e.speedChanger===t.speedChanger&&e.hasSong===t.hasSong&&e.isMetronomePlaying===t.isMetronomePlaying&&e.isRecordingAudio===t.isRecordingAudio&&e.isVisualSheetVisible===t.isVisualSheetVisible}),eI=(0,h.memo)(function(){var e=(0,x.$d)(P.score),t=e.combo,n=e.score,r=e.correct,a=e.wrong;return(0,d.jsx)("div",{className:"approaching-accuracy",children:(0,d.jsx)("table",{children:(0,d.jsxs)("tbody",{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"sc-2",children:"Accuracy"}),(0,d.jsxs)("td",{className:"sc-1",children:[(r/(r+a-1)*100).toFixed(1),"%"]})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"sc-2",children:"Score"}),(0,d.jsx)("td",{className:"sc-1",children:n})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{className:"sc-2",children:"Combo"}),(0,d.jsx)("td",{className:"sc-1",children:t})]})]})})})},function(){return!0}),eT=n(6880),eL=function(e){(0,o.Z)(n,e);var t=(0,u.Z)(n);function n(e){(0,s.Z)(this,n),(x=t.call(this,e)).cleanup=[];var o,u,d,h,g,m,f,y,v,x,S=(0,r.Z)(x);x.init=(o=(0,a.Z)(function(e){return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,ex.n.waitReverb()];case 1:return t.sent(),[4,S.loadInstrument(e.instrument.value)];case 2:return t.sent(),S.registerKeyboardListeners(),ex.n.setReverb(e.caveMode.value),[2]}})}),function(e){return o.apply(this,arguments)}),x.registerKeyboardListeners=function(){A.w.registerLetter("C",function(){return x.toggleRecord()},{shift:!0,id:"player"})},x.setHasSong=function(e){x.setState({hasSong:e})},x.changeVolume=function(e){var t=x.state,n=t.settings,r=t.instruments;"instrument"===e.key&&(n.instrument=(0,c.Z)((0,i.Z)({},n.instrument),{volume:e.value}),r.forEach(function(t){return t.changeVolume(e.value)})),x.setState({settings:n},x.updateSettings)};var k=(0,r.Z)(x);x.loadInstrument=(u=(0,a.Z)(function(e){var t,n,r,a,s;return(0,l.__generator)(this,function(o){switch(o.label){case 0:return t=k.state.instruments[0],ex.n.disconnect(t.endNode),k.state.instruments[0].dispose(),r=(n=k.state).settings,a=n.instruments,(s=new ey.ZP(e)).changeVolume(r.instrument.volume||100),k.setState({isLoadingInstrument:!0}),[4,s.load(ex.n.getAudioContext())];case 1:if(o.sent()||H.kg.error("There was an error loading the instrument"),ex.n.connect(s.endNode),!k.mounted)return[2];return N.setKeyboardLayout(s.notes),a.splice(0,1,s),k.setState({instruments:a,isLoadingInstrument:!1},function(){return ex.n.setReverb(r.caveMode.value)}),[2]}})}),function(e){return u.apply(this,arguments)}),x.handleSpeedChanger=function(e){var t=p.Qk.find(function(t){return t.name===e.target.value});t&&x.setState({speedChanger:t},function(){return x.restartSong()})};var b=(0,r.Z)(x);x.restartSong=(d=(0,a.Z)(function(e){return(0,l.__generator)(this,function(t){return b.mounted&&N.restartSong("number"==typeof e?e:P.position,P.end),[2]})}),function(e){return d.apply(this,arguments)});var j=(0,r.Z)(x);x.loadInstruments=(h=(0,a.Z)(function(e){var t,n,r;return(0,l.__generator)(this,function(s){switch(s.label){case 0:var o;return(t=j.state.instruments).splice(e.length).forEach(function(e){ex.n.disconnect(e.endNode),e.dispose()}),H.kg.showPill("Loading instruments..."),[4,Promise.all(e.map((o=(0,a.Z)(function(e,n){var r,a,s;return(0,l.__generator)(this,function(o){switch(o.label){case 0:if(void 0!==t[n])return[3,2];return r=new ey.ZP(e.name),t[n]=r,[4,r.load(ex.n.getAudioContext())];case 1:if(o.sent()||H.kg.error("There was an error loading the instrument"),!j.mounted)return[2,r.dispose()];return ex.n.connect(r.endNode),r.changeVolume(e.volume),[2,r];case 2:if(t[n].name!==e.name)return[3,3];return t[n].changeVolume(e.volume),[2,t[n]];case 3:return a=t[n],ex.n.disconnect(a.endNode),a.dispose(),s=new ey.ZP(e.name),t[n]=s,[4,s.load(ex.n.getAudioContext())];case 4:if(o.sent()||H.kg.error("There was an error loading the instrument"),!j.mounted)return[2,s.dispose()];return ex.n.connect(s.endNode),s.changeVolume(e.volume),[2,s];case 5:return[2]}})}),function(e,t){return o.apply(this,arguments)})))];case 1:if(n=s.sent(),!j.mounted)return[2];return r=j.state.settings,t[0]&&(r.instrument=(0,c.Z)((0,i.Z)({},r.instrument),{value:t[0].name}),N.setKeyboardLayout(t[0].notes)),H.kg.hidePill(),j.setState({instruments:n,settings:r},j.updateSettings),[2]}})}),function(e){return h.apply(this,arguments)}),x.playSound=function(e,t){var n=(0,r.Z)(x).state,a=n.settings,s=n.instruments;n.isRecording&&x.handleRecording(e),t?s.forEach(function(n,r){t.test(r)&&n.play(e,a.pitch.value)}):s[0].play(e,a.pitch.value)},x.updateSettings=function(e){eg.j.updatePlayerSettings(void 0!==e?e:x.state.settings)},x.handleSettingChange=function(e){var t=x.state.settings,n=e.data;t[e.key]=(0,c.Z)((0,i.Z)({},t[e.key]),{value:n.value}),"instrument"===e.key&&x.loadInstrument(n.value),"caveMode"===e.key&&ex.n.setReverb(n.value),"bpm"===e.key&&(ek.A.bpm=n.value),"metronomeBeats"===e.key&&(ek.A.beats=n.value),"metronomeVolume"===e.key&&ek.A.changeVolume(n.value),x.setState({settings:t},x.updateSettings)},x.addSong=(g=(0,a.Z)(function(e){var t,n,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,eo.k.addSong(e)];case 1:return t=a.sent(),e.id=t,r=null!==(n=e.type)&&void 0!==n?n:e.data.isComposedVersion?"composed":"recorded",H.kg.success("Song added to the ".concat(r," tab!"),4e3),[3,3];case 2:return console.error(a.sent()),[2,H.kg.error("There was an error importing the song")];case 3:return[2]}})}),function(e){return g.apply(this,arguments)});var C=(0,r.Z)(x);x.removeSong=(m=(0,a.Z)(function(e,t){var n;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return[4,(0,ea.jH)('Are you sure you want to delete the song: "'.concat(e,'" ?'))];case 1:if(n=r.sent(),!C.mounted)return[2];if(!n)return[3,3];return[4,eo.k.removeSong(t)];case 2:r.sent(),_.Z.userSongs("delete",{page:"player"}),r.label=3;case 3:return[2]}})}),function(e,t){return m.apply(this,arguments)}),x.renameSong=(f=(0,a.Z)(function(e,t){return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,eo.k.renameSong(t,e)];case 1:return n.sent(),[2]}})}),function(e,t){return f.apply(this,arguments)}),x.handleRecording=function(e){x.state.isRecording&&x.recording.addNote(e)},x.toggleMetronome=function(){var e=x.state,t=e.isMetronomePlaying,n=e.settings;x.setState({isMetronomePlaying:!t}),t?ek.A.stop():(ek.A.bpm=n.bpm.value,ek.A.beats=n.metronomeBeats.value,ek.A.changeVolume(n.metronomeVolume.value),ek.A.start())};var w=(0,r.Z)(x);x.toggleRecord=(y=(0,a.Z)(function(e){var t,n,r,a,s,o;return(0,l.__generator)(this,function(i){switch(i.label){case 0:if("boolean"!=typeof e&&(e=null),!(!(t=null!==e?e:!w.state.isRecording)&&w.recording.notes.length>0))return[3,2];return r=(n=w.state).instruments,a=n.settings,[4,(0,ea.cJ)("Write song name, press cancel to ignore")];case 1:if(s=i.sent(),!w.mounted)return[2];return null!==s&&((o=new T.M(s,w.recording.notes,[r[0].name])).bpm=a.bpm.value,o.pitch=a.pitch.value,w.addSong(o),_.Z.userSongs("record",{name:s,page:"player"})),[3,3];case 2:w.recording=new I.xd,i.label=3;case 3:return w.setState({isRecording:t}),[2]}})}),function(e){return y.apply(this,arguments)});var Z=(0,r.Z)(x);return x.toggleRecordAudio=(v=(0,a.Z)(function(e){var t,n,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:if(!Z.mounted)return[2];if("boolean"!=typeof e&&(e=null),t=null!==e?e:!Z.state.isRecordingAudio,Z.setState({isRecordingAudio:t}),!t)return[3,1];return ex.n.startRecording(),[3,4];case 1:return[4,ex.n.stopRecording()];case 2:return n=a.sent(),[4,(0,ea.cJ)("Write the song name, press cancel to ignore")];case 3:if(r=a.sent(),!Z.mounted||!n)return[2];r&&ev.Z.downloadBlob(n.data,r+".wav"),a.label=4;case 4:return[2]}})}),function(e){return v.apply(this,arguments)}),x.recording=new I.xd,x.state={instruments:[new ey.ZP],settings:eg.j.getDefaultPlayerSettings(),isLoadingInstrument:!0,isRecording:!1,isRecordingAudio:!1,isMetronomePlaying:!1,hasSong:!1,speedChanger:p.Qk.find(function(e){return"x1"===e.name})},x.mounted=!1,x}var h=n.prototype;return h.componentDidMount=function(){var e=this;return(0,a.Z)(function(){var t,n,r;return(0,l.__generator)(this,function(a){switch(a.label){case 0:return t=eg.j.getPlayerSettings(),e.setState({settings:t}),e.mounted=!0,(n=e.state.instruments[0])&&N.setKeyboardLayout(n.notes),[4,e.init(t)];case 1:return a.sent(),r=(0,x.VZ)(N.state,function(t){var n=t.eventType,r=t.song,a=e.state.settings;a.syncSongData.value&&null!==r&&(["play","practice","approaching"].includes(n)&&e.handleSettingChange({data:(0,c.Z)((0,i.Z)({},a.pitch),{value:r.pitch}),key:"pitch"}),e.loadInstruments(r.instruments))}),e.cleanup.push(r),[2]}})})()},h.componentWillUnmount=function(){A.w.unregisterById("player"),N.resetSong(),N.resetKeyboardLayout(),P.clearPages(),P.resetScore(),ex.n.clear(),H.kg.hidePill(),this.state.instruments.forEach(function(e){return e.dispose()}),this.cleanup.forEach(function(e){return e()}),this.mounted=!1,ek.A.stop()},h.render=function(){var e=this,t=this.state,n=this.renameSong,r=this.playSound,a=this.setHasSong,s=this.removeSong,o=this.handleSettingChange,i=this.changeVolume,c=this.addSong,u=this.toggleMetronome,l=t.settings,h=t.isLoadingInstrument,g=t.instruments,p=t.hasSong,m=t.isRecordingAudio,f=t.isRecording,y=t.isMetronomePlaying,v=t.speedChanger;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(eS.D,{text:"Player"}),(0,d.jsx)(ef,{functions:{addSong:c,removeSong:s,handleSettingChange:o,changeVolume:i,renameSong:n},data:{settings:l}}),(0,d.jsxs)("div",{className:"right-panel",children:[(0,d.jsx)("div",{className:"upper-right",children:!p&&(0,d.jsx)(J.J,{toggled:f,onClick:function(){return e.toggleRecord()},style:{marginTop:"0.8rem"},children:f?"Stop":"Record"})}),(0,d.jsx)("div",{className:"keyboard-wrapper",children:(0,d.jsx)(D,{data:{isLoading:h,instrument:g[0],pitch:l.pitch.value,keyboardSize:l.keyboardSize.value,noteNameType:l.noteNameType.value,hasSong:p,hasAnimation:l.noteAnimation.value,approachRate:l.approachSpeed.value,keyboardYPosition:l.keyboardYPosition.value,speedChanger:v},functions:{playSound:r,setHasSong:a}})})]}),(0,d.jsx)(eP,{isRecordingAudio:m,isVisualSheetVisible:l.showVisualSheet.value,onToggleRecordAudio:this.toggleRecordAudio,onRestart:this.restartSong,isMetronomePlaying:y,onToggleMetronome:u,onRawSpeedChange:this.handleSpeedChanger,hasSong:p,speedChanger:v})]})},n}(h.Component);function eA(){return(0,d.jsx)(eL,{})}eA.getLayout=function(e){return(0,d.jsx)(eT.Z,{page:"Main",children:e})}}}]);