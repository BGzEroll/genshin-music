"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{5736:function(e,t,n){n.d(t,{O:function(){return g}});var s=n(6042),r=n(5893),i=n(2169),o=[],a=[],l=!0,c=!1,u=void 0;try{for(var d,h=i.BX[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var m=d.value;m.startsWith("SFX")?a.push(m):o.push(m)}}catch(e){c=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(c)throw u}}function g(e){var t=e.selected,n=e.onChange,i=e.style;return(0,r.jsx)("select",{className:"select",style:(0,s.Z)({width:"100%",padding:"0.3rem"},i),onChange:function(e){return n(e.target.value)},value:t,children:0===a.length?(0,r.jsx)(r.Fragment,{children:o.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ")},e)})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("optgroup",{label:"Instruments",children:o.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ")},e)})}),(0,r.jsx)("optgroup",{label:"SFX",children:a.map(function(e){return(0,r.jsx)("option",{value:e,children:e.replace("-"," ").replace("SFX_","")},e)})})]})})}},6912:function(e,t,n){n.d(t,{x:function(){return o}});var s=n(6042),r=n(5893),i=n(2169);function o(e){var t=e.selected,n=e.onChange,o=e.style,a=e.children,l=e.className;return(0,r.jsxs)("select",{className:"select ".concat(null!=l?l:""),style:(0,s.Z)({width:"100%",padding:"0.3rem"},o),onChange:function(e){return n(e.target.value)},value:t,children:[a,i.T_.map(function(e){return(0,r.jsx)("option",{children:e},e)})]})}},1709:function(e,t,n){n.d(t,{P:function(){return a}});var s=n(6042),r=n(828),i=n(5893),o=n(5055);function a(e){var t=e.onChange,n=e.value,a=e.children,l=e.style,c=(0,r.Z)((0,o.F)(),1)[0];return(0,i.jsx)("select",{onChange:t,value:n,className:"select",style:(0,s.Z)({backgroundImage:"url(\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' height='24' viewBox='0 0 24 24' width='24' fill='".concat(c.getText("primary").hex().replace("#","%23"),"'><path d='M0 0h24v24H0z' fill='none'/><path d='M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z'/></svg>\")")},l),children:a})}},2926:function(e,t,n){n.r(t),n.d(t,{default:function(){return eG}});var s=n(4111),r=n(7568),i=n(1438),o=n(2951),a=n(8668),l=n(6042),c=n(9396),u=n(828),d=n(6305),h=n(6626),m=n(655),g=n(5893),f=n(7294),p=n(9583),v=n(2169);function x(e){var t=e.className;return(0,g.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,g.jsxs)("g",{children:[(0,g.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,g.jsx)("path",{d:"m 42.968955,90.42652 c -2.198688,0 -3.96875,1.770063 -3.96875,3.96875 v 35.03145 H 3.9687499 C 1.7700625,129.42672 0,131.19678 0,133.39547 v 24.0621 c 0,2.19869 1.7700625,3.96875 3.9687499,3.96875 H 39.000205 v 35.03145 c 0,2.19869 1.770062,3.96875 3.96875,3.96875 h 24.062613 c 2.198687,0 3.968749,-1.77006 3.968749,-3.96875 v -35.03145 h 35.030933 c 2.19869,0 3.96875,-1.77006 3.96875,-3.96875 v -24.0621 c 0,-2.19869 -1.77006,-3.96875 -3.96875,-3.96875 H 71.000317 V 94.39527 c 0,-2.198687 -1.770062,-3.96875 -3.968749,-3.96875 z"}),(0,g.jsx)("rect",{width:"7.8557625",height:"1.5711526",x:"57.085205",y:"139.30885",rx:"3.96875"})]})})}function y(e){var t=e.className;return(0,g.jsx)("svg",{width:"194.40327mm",height:"290.853mm",viewBox:"0 0 194.40327 290.85299",xmlns:"http://www.w3.org/2000/svg",className:t,style:{fill:"currentcolor"},children:(0,g.jsxs)("g",{children:[(0,g.jsx)("rect",{width:"50.962246",height:"290.853",x:"143.44104",y:"2.4868996e-14",rx:"15.05095",ry:"17.061689"}),(0,g.jsx)("rect",{width:"110.35661",height:"35.805271",x:"0",y:"127.52386",rx:"3.96875"})]})})}var b=n(1446),j=n(2452),C=n(6743),w=n(539),k=n(8778),S=n(4339),N=n(3564),Z=n(8949),R=n(3544),T=n(3439),P=n(515),A=n(6912),L=n(6806),I=function(e,t){var n=(0,u.Z)((0,f.useState)(e),2),s=n[0],r=n[1];return(0,f.useEffect)(function(){var n=setTimeout(function(){r(e)},t);return function(){return clearTimeout(n)}},[e,t]),s},_=n(1709),E=n(1014);function M(e){var t=e.onChange,n=e.value,s=e.delay,r=e.step,i=void 0===r?1:r,o=e.style,a=e.placeholder,c=e.className,d=(0,u.Z)((0,f.useState)("".concat(n)),2),h=d[0],m=d[1],p=I(h,void 0===s?800:s);return(0,f.useEffect)(function(){var e=Number(p);Number.isFinite(e)?t(e):m("0")},[p,t]),(0,f.useEffect)(function(){m("".concat(n))},[n]),(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},className:c,children:[(0,g.jsx)("button",{onClick:function(){return m("".concat(Number(h)-i))},className:"midi-btn-small",style:o,children:"-"}),(0,g.jsx)("input",{type:"text",placeholder:a,value:h,onChange:function(e){return m(e.target.value)},className:"midi-input",style:(0,l.Z)({margin:"0 0.3rem"},o)}),(0,g.jsx)("button",{onClick:function(){return m("".concat(Number(h)+i))},className:"midi-btn-small",style:o,children:"+"})]})}function B(e){var t,n=e.data,s=e.index,r=e.onChange,i=e.theme,o=e.instruments,a=(0,u.Z)((0,f.useState)(!1),2),l=a[0],c=a[1],d={backgroundColor:i.layer("menu_background",.15).toString()},h=(0,u.Z)((0,f.useState)("".concat(null!==(t=n.localOffset)&&void 0!==t?t:"")),2),m=h[0],v=h[1],x=I(m,600);(0,f.useEffect)(function(){var e=parseInt(x),t=Number.isFinite(e)?e:null;v("".concat(null!=t?t:"")),r(s,{localOffset:t})},[x,r,s]),(0,f.useEffect)(function(){var e;v("".concat(null!==(e=n.localOffset)&&void 0!==e?e:""))},[n.localOffset]);var y=(0,f.useCallback)(function(e){r(s,{maxScaling:Math.max(0,e)})},[r,s]);return(0,g.jsxs)("div",{className:"midi-track-column",style:d,children:[(0,g.jsxs)("div",{className:"midi-track-wrapper",children:[(0,g.jsxs)("div",{className:"midi-track-center",children:[(0,g.jsx)("input",{type:"checkbox",onChange:function(){return r(s,{selected:!n.selected})},checked:n.selected}),"".concat(n.name," "),"(",n.track.notes.length,","," ".concat(n.track.instrument.family),")"]}),(0,g.jsxs)("div",{className:"midi-track-center",children:[(0,g.jsx)(_.P,{onChange:function(e){return r(s,{layer:Number(e.target.value)})},value:n.layer,className:"midi-select",style:{marginLeft:"0.2rem"},children:o.map(function(e,t){return(0,g.jsxs)("option",{value:t,children:[e.alias||e.name," - ","Layer ".concat(t+1)]},t)})}),(0,g.jsx)(p.LCi,{size:22,color:"var(--primary)",onClick:function(){return c(!l)},cursor:"pointer"})]})]}),(0,g.jsxs)("div",{className:"midi-track-data",style:{display:l?"flex":"none"},children:[(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{className:(0,E.h)(!0),children:[(0,g.jsx)(E.u,{children:"Changes the index of each note by this amount."}),"Track offset:"]}),(0,g.jsx)("input",{type:"text",value:m,placeholder:"No offset",className:"midi-input",style:{width:"6.3rem"},onChange:function(e){return v(e.target.value)}})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{className:(0,E.h)(!0),children:[(0,g.jsx)(E.u,{children:"Scale down/up the notes which are out of scale by theose octaves."}),"Max notes octave scaling:"]}),(0,g.jsx)(M,{value:n.maxScaling,placeholder:"No scaling",onChange:y})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Instrument:"}),(0,g.jsx)("div",{children:n.track.instrument.name})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Number of notes:"}),(0,g.jsx)("div",{children:n.track.notes.length})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsx)("div",{children:"Accidentals:"}),(0,g.jsx)("div",{children:n.numberOfAccidentals})]}),(0,g.jsxs)("div",{className:"midi-track-data-row",children:[(0,g.jsxs)("div",{children:["Out of range: (",n.outOfRangeBounds.upper+n.outOfRangeBounds.lower,")"]}),(0,g.jsxs)("div",{className:"row",style:{width:"fit-content"},children:[(0,g.jsxs)("div",{className:"row",style:{marginRight:"0.4rem"},children:[(0,g.jsx)(p.ZTc,{style:{marginRight:"0.2rem"}}),n.outOfRangeBounds.upper]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)(p.NWQ,{style:{marginRight:"0.2rem"}}),n.outOfRangeBounds.lower]})]})]})]})]})}var O=function(e){(0,a.Z)(n,e);var t=(0,h.Z)(n);function n(e){var s;return(0,i.Z)(this,n),(s=t.call(this,e)).handleFile=function(e){try{if(0===e.length)return;var t,n,r=e[0],i=new j.Midi(r.data),o=null===(t=i.header.tempos[0])||void 0===t?void 0:t.bpm,a=null===(n=i.header.keySignatures[0])||void 0===n?void 0:n.key,l=i.tracks.map(function(e,t){return{track:e,selected:!0,layer:0,name:e.name||"Track n.".concat(t+1),numberOfAccidentals:0,maxScaling:0,outOfRangeBounds:{lower:0,upper:0},localOffset:null}});s.setState({tracks:l,fileName:r.file.name,bpm:Math.floor(4*o)||220,offset:0,pitch:v.T_.includes(a)?a:"C"},function(){s.state.tracks.length&&s.convertMidi()})}catch(e){console.error(e),S.kg.error("There was an error importing this file, is it a .mid file?")}},s.convertMidi=function(){var e=s.state,t=e.tracks,n=e.bpm,r=e.offset,i=e.includeAccidentals,o=e.pitch,a=t.filter(function(e){return e.selected}),l=[],c=0,u=0,h=0;a.forEach(function(e){e.numberOfAccidentals=0,e.outOfRangeBounds.upper=0,e.outOfRangeBounds.lower=0,e.track.notes.forEach(function(t){h++;var n,s=w.LG.fromMidi(e.layer,Math.floor(1e3*t.time),t.midi-(null!==(n=e.localOffset)&&void 0!==n?n:r),e.maxScaling);s.data.isAccidental&&(c++,e.numberOfAccidentals++),-1!==s.data.note?(i||!s.data.isAccidental)&&l.push(s):(u++,-1===s.data.outOfRangeBound&&e.outOfRangeBounds.lower++,1===s.data.outOfRangeBound&&e.outOfRangeBounds.upper++)})});for(var m=l.sort(function(e,t){return e.time-t.time}),g=Math.floor(6e4/n),f=[];m.length>0;){for(var p=[m.shift()],v=0,x=0;x<m.length;x++)p[0].time>m[x].time-g/9&&v++;f.push((0,d.Z)(p).concat((0,d.Z)(m.splice(0,v))))}var y=[],b=0;f.forEach(function(e){var t=e[0];if(t){var n=Math.floor((t.time-b-g)/g),s=new w.sg;b=t.time,n>-1&&Array(n).fill(0).forEach(function(){return y.push(new w.sg)}),s.notes=e.map(function(e){var t=new T.u;return t.set(e.layer,!0),new w.Ws(e.data.note,t)}),y.push(s)}}),y.forEach(function(e){var t=(0,C.l3)(e);e.notes=t.map(function(e){return e[0].layer=(0,C.UV)(e),e[0]})});var j=new k.l("Untitled");j.columns=y,j.bpm=n,j.instruments=[],j.instruments=s.props.data.instruments.map(function(e){return e.clone()}),j.pitch=o;var N=s.props.data.selectedColumn;if(j.selected=N<j.columns.length?N:0,0===j.columns.length)return S.kg.warn("There are no notes");s.props.functions.loadSong(j),s.setState({accidentals:c,totalNotes:h,outOfRange:u})},s.editTrack=function(e,t){var n=s.state.tracks;Object.assign(n[e],t),s.setState({tracks:n},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changeOffset=function(e){Number.isInteger(e)||(e=0),s.state.offset!==e&&s.setState({offset:e},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changePitch=function(e){s.props.functions.changePitch(e),s.setState({pitch:e})},s.toggleAccidentals=function(){s.setState({includeAccidentals:!s.state.includeAccidentals},function(){s.state.tracks.length>0&&s.convertMidi()})},s.changeBpm=function(e){Number.isInteger(e)||(e=0),s.state.bpm!==e&&s.setState({bpm:e},function(){s.state.tracks.length>0&&s.convertMidi()})},s.state={fileName:"",bpm:220,tracks:[],offset:0,pitch:"C",ignoreEmptytracks:!1,accidentals:0,outOfRange:0,totalNotes:0,includeAccidentals:!0,theme:N.f6},s.dispose=function(){},s}var s=n.prototype;return s.componentDidMount=function(){var e=this;this.dispose=(0,Z.N7)(N.f6.state.data,function(){e.setState({theme:(0,l.Z)({},N.f6)})})},s.componentWillUnmount=function(){this.dispose()},s.render=function(){var e=this,t=this.handleFile,n=this.editTrack,s=this.state,r=this.changeBpm,i=this.changeOffset,o=this.changePitch,a=s.tracks,c=s.fileName,u=s.bpm,d=s.offset,h=s.pitch,m=s.accidentals,f=s.outOfRange,p=s.totalNotes,v=s.includeAccidentals,x=s.theme,y=s.ignoreEmptytracks,j=this.props,C=j.functions,w=j.data,k=C.changeMidiVisibility,S={backgroundColor:x.layer("primary",.2).toString(),color:x.getText("primary").toString()};return(0,g.jsx)(L.s,{boxProps:{className:"floating-midi"},size:"1.2rem",isRelative:!1,offset:"0.1rem",children:(0,g.jsxs)("div",{className:"column floating-midi-content",children:[(0,g.jsxs)("div",{className:"midi-row separator-border",style:{width:"100%"},children:[(0,g.jsx)(b.G,{onPick:t,as:"buffer",children:(0,g.jsx)("button",{className:"midi-btn",style:S,children:"Open midi file"})}),(0,g.jsx)("div",{style:{margin:"0 0.5rem",maxWidth:"20rem"},className:"text-ellipsis",children:c}),(0,g.jsx)("button",{className:"midi-btn",style:(0,l.Z)({marginLeft:"auto"},S),onClick:function(){return k(!1)},children:"Close"})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Bpm:"}),(0,g.jsx)(M,{value:u,onChange:r,delay:600,style:S,step:5})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsxs)("div",{className:"row flex-centered",children:[(0,g.jsx)("span",{style:{marginRight:"0.5rem"},children:"Global note offset: "}),(0,g.jsx)(P.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},children:"The index of each note will be pushed up/down by this amount, you can use it to make the song fit into the app range. You can also change the offset of each layer."})]}),(0,g.jsx)(M,{value:d,onChange:i,delay:600,style:S,step:1})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Pitch:"}),(0,g.jsx)(A.x,{style:(0,l.Z)({width:"5rem"},S),selected:h,onChange:o})]}),(0,g.jsxs)("div",{className:"midi-table-row",children:[(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Include accidentals:"}),(0,g.jsx)(R.Z,{checked:v,onChange:this.toggleAccidentals,styleOuter:S})]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("div",{style:{marginRight:"0.5rem"},children:"Ignore empty tracks:"}),(0,g.jsx)(R.Z,{checked:y,onChange:function(t){return e.setState({ignoreEmptytracks:t})},styleOuter:S})]})]}),a.length>0&&(0,g.jsx)("div",{className:"midi-column separator-border",style:{width:"100%"},children:(0,g.jsxs)("div",{className:"midi-column",style:{width:"100%"},children:[(0,g.jsx)("div",{children:"Select midi tracks"}),a.map(function(e,t){return!(y&&0===e.track.notes.length)&&(0,g.jsx)(B,{data:e,instruments:w.instruments,index:t,onChange:n,theme:x},t)})]})}),a.length>0&&(0,g.jsx)("table",{children:(0,g.jsxs)("tbody",{children:[(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Total notes: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:p})]}),(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Accidentals: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:m})]}),(0,g.jsxs)("tr",{children:[(0,g.jsx)("td",{children:"Out of range: "}),(0,g.jsx)("td",{}),(0,g.jsx)("td",{children:f})]})]})})]})})},n}(f.Component),H=n(8461),D=n(5055),F=n(5434),V=n(7106),z=(0,f.memo)(function(e){var t=e.data,n=e.functions,s=(0,u.Z)((0,D.F)(),1)[0],r=(0,u.Z)((0,f.useState)("all"),2),i=r[0],o=r[1],a=n.toggleTools,l=n.copyColumns,c=n.eraseColumns,d=n.pasteColumns,h=n.deleteColumns,m=n.resetSelection,v=n.undo,x=n.moveNotesBy,y=t.isToolsVisible,b=t.hasCopiedColumns,j=t.layer,C=t.selectedColumns,w=t.undoHistory,k="all"===i?"all":j;return(0,g.jsxs)("div",{className:"floating-tools ".concat(y?"floating-tools tools-visible":""),style:{backgroundColor:s.get("menu_background").fade(.1).toString()},children:[(0,g.jsxs)("div",{className:"tools-buttons-grid",children:[(0,g.jsxs)(W,{area:"a",disabled:b,onClick:function(){return l(k)},active:b,tooltip:"Copy all notes",style:{flexDirection:"column",justifyContent:"center"},tooltipPosition:"bottom",children:[(0,g.jsx)(p.esY,{className:"tools-icon",size:24}),"Copy"]}),(0,g.jsxs)(W,{disabled:!b,onClick:function(){return d(!1,k)},tooltip:"Paste copied notes",area:"b",tooltipPosition:"bottom",children:[(0,g.jsx)(p.VGm,{className:"tools-icon"}),"Paste ","all"===i?"":"in layer ".concat(j+1)]}),(0,g.jsxs)(W,{disabled:!b,onClick:function(){return d(!0,k)},tooltip:"Insert copied notes",area:"c",children:[(0,g.jsx)(V.ODP,{className:"tools-icon",style:{strokeWidth:"3px"}}),"Insert ","all"===i?"":"in layer ".concat(j+1)]}),(0,g.jsxs)(W,{disabled:b,onClick:function(){return c(k)},tooltip:"Erase all selected notes",area:"d",children:[(0,g.jsx)(p.arg,{className:"tools-icon"}),"Erase"]}),(0,g.jsxs)(W,{disabled:b||"all"!==k,onClick:h,tooltip:"Delete selected columns",area:"f",children:[(0,g.jsx)(p.Xm5,{className:"tools-icon",color:"var(--red)"}),"Delete"]}),(0,g.jsxs)(W,{disabled:b,tooltip:"Push notes up by 1 position",area:"e",onClick:function(){return x(1,k)},children:[(0,g.jsx)(p.$Pg,{className:"tools-icon"}),"Move notes up"]}),(0,g.jsxs)(W,{disabled:b,tooltip:"Push notes down by 1 position",onClick:function(){return x(-1,k)},area:"g",children:[(0,g.jsx)(p.iUH,{className:"tools-icon"}),"Move notes down"]})]}),(0,g.jsxs)("div",{className:"tools-right column",children:[(0,g.jsxs)(H.J,{style:{marginBottom:"0.2rem"},className:(0,E.h)(!0),toggled:"all"===i,onClick:function(){return o("all")},children:[(0,g.jsx)(F.L_o,{style:{marginRight:"0.2rem"},size:16}),"All layers",(0,g.jsx)(E.u,{style:{left:0},children:"Select all the layers in the highlighted columns"})]}),(0,g.jsxs)(H.J,{style:{marginBottom:"0.2rem"},className:(0,E.h)(!0),toggled:"layer"===i,onClick:function(){return o("layer")},children:[(0,g.jsx)(F.yo,{style:{marginRight:"0.2rem"},size:16}),"Only Layer",(0,g.jsx)("span",{style:{minWidth:"0.6rem",marginLeft:"0.2rem"},children:j+1}),(0,g.jsx)(E.u,{style:{left:0},children:"Select all the notes in the highlighted columns of the current layer"})]}),(0,g.jsx)(H.J,{style:{marginBottom:"0.2rem",justifyContent:"center"},onClick:m,disabled:C.length<=1&&!b,toggled:b,children:"Clear selection"}),(0,g.jsxs)("div",{className:"row",style:{flex:"1",alignItems:"flex-end"},children:[(0,g.jsx)(H.J,{style:{flex:"1",justifyContent:"center"},disabled:0===w.length,onClick:v,children:"Undo"}),(0,g.jsx)(H.J,{onClick:a,style:{marginLeft:"0.2rem",flex:"1",justifyContent:"center"},children:"Ok"})]})]})]})},function(e,t){return e.data.isToolsVisible===t.data.isToolsVisible&&e.data.hasCopiedColumns===t.data.hasCopiedColumns&&e.data.layer===t.data.layer&&e.data.selectedColumns===t.data.selectedColumns&&e.data.undoHistory===t.data.undoHistory});function W(e){var t=e.disabled,n=e.onClick,s=e.active,r=e.style,i=e.children,o=e.tooltip,a=e.area,c=e.tooltipPosition;return(0,g.jsxs)("button",{disabled:t,onClick:n,className:"flex-centered tools-button ".concat(s?"tools-button-highlighted":""," ").concat((0,E.h)(o)),style:(0,l.Z)({gridArea:a},r),children:[i,o&&(0,g.jsx)(E.u,{position:c||"top",children:o})]})}var J=n(8376),U=n(2114);function X(){var e=N.f6.get("note_background");return"Genshin"!==v.iC?e.isDark()?v.kx.text.light:v.kx.text.dark:e.luminosity()>.65?v.kx.text.note:e.isDark()?v.kx.text.light:v.kx.text.dark}var Y=(0,f.memo)(function(e){var t,n=e.data,s=e.layer,r=e.instrument,i=e.clickAction,o=e.noteText,a=e.noteImage,l=(0,u.Z)((0,f.useState)(X()),2),c=l[0],d=l[1];(0,f.useEffect)(function(){return(0,Z.N7)(N.f6.state.data,function(){d(X())})},[]);var h=v.Al.noteComposer;(1&s)!=0&&(h+=" layer-1"),(2&s)!=0&&(h+=" layer-2"),(4&s)!=0&&(h+=" layer-3"),(8&s)!=0&&(h+=" layer-4");var m=N.f6.get("note_background").desaturate(.6);return(0,g.jsx)("button",{onPointerDown:function(){return i(n)},className:"button-hitbox",children:(0,g.jsxs)("div",{className:h,children:["Genshin"===v.iC&&(0,g.jsx)(J.Z,{fill:m.isDark()?m.lighten(.45).hex():m.darken(.18).hex(),className:"genshin-border"}),(0,g.jsx)(U.Z,{name:a,color:N.f6.isDefault("accent")?null===(t=v.as[r])||void 0===t?void 0:t.fill:void 0,background:"var(--note-background)"}),(0,g.jsx)("div",{className:"layer-3-ball-bigger"}),(0,g.jsx)("div",{className:"layer-4-line"}),(0,g.jsx)("div",{className:"Sky"===v.iC?"note-name-sky":"note-name",style:{color:c},children:o})]})})},function(e,t){return e.noteText===t.noteText&&e.clickAction===t.clickAction&&e.noteImage===t.noteImage&&e.noteText===t.noteText&&e.layer===t.layer&&e.instrument===t.instrument});function G(e){var t=e.data,n=e.functions,s=t.keyboard,r=t.isPlaying,i=t.noteNameType,o=t.currentColumn,a=t.pitch,d=t.currentLayer,h=t.isRecordingAudio;t.settings;var m=n.handleClick,f=n.handleTempoChanger,x=(0,u.Z)((0,D.F)(),1)[0];if(void 0===s)return(0,g.jsx)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem"},children:(0,g.jsx)("h1",{children:"There was an error with this layer"})});if(h)return(0,g.jsx)("div",{className:"composer-keyboard-wrapper",style:{marginBottom:"4rem"},children:(0,g.jsx)("h1",{children:"Recording Audio..."})});var y="keyboard";return 15===s.notes.length&&(y+=" keyboard-5"),14===s.notes.length&&(y+=" keyboard-5"),8===s.notes.length&&(y+=" keyboard-4"),6===s.notes.length&&(y+=" keyboard-3"),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:"composer-keyboard-wrapper",children:[t.settings.useKeyboardSideButtons.value&&(0,g.jsx)("button",{onPointerDown:function(){return n.selectColumnFromDirection(-1)},className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingRight:"0.5rem",justifyContent:"flex-end"},children:(0,g.jsx)(p.bUI,{})}),(0,g.jsxs)("div",{className:y,children:[0===s.notes.length?(0,g.jsx)("div",{className:"loading",children:"Loading..."}):null,s.notes.map(function(e,n){try{var r=o.notes.findIndex(function(e){return e.index===n});return(0,g.jsx)(Y,{layer:r>=0?o.notes[r].layer.toLayerStatus(d,t.instruments):0,data:e,noteText:s.getNoteText(n,i,a),instrument:s.name,noteImage:e.noteImage,clickAction:m},e.index)}catch(e){return"Err"}})]}),t.settings.useKeyboardSideButtons.value&&(0,g.jsx)("button",{onPointerDown:function(){return n.selectColumnFromDirection(1)},className:"keyboard-column-selection-buttons ".concat(t.isPlaying?"":"keyboard-column-selection-buttons-visible"),style:{paddingLeft:"0.5rem",justifyContent:"flex-start"},children:(0,g.jsx)(p.Dli,{})})]}),(0,g.jsxs)("div",{className:"tempo-changers-wrapper ".concat(r?"tempo-changers-wrapper-hidden":""),children:[(0,g.jsx)("div",{className:"bottom-right-text",children:"Tempo"}),v.nq.map(function(e){return(0,g.jsx)("button",{onClick:function(){return f(e)},style:(0,c.Z)((0,l.Z)({},1===e.changer?{backgroundColor:x.get("primary").toString(),color:x.getText("primary").toString()}:{backgroundColor:"#"+e.color.toString(16)}),{outline:t.currentColumn.tempoChanger===e.id?"3px ".concat(x.get("composer_accent").toString()," solid"):"",margin:"",outlineOffset:"-3px"}),children:e.text},e.id)})]})]})}var K=n(8810),q=n(3805),Q=n.n(q),$=n(6767),ee=n.n($),et=n(7564),en=n(3531);et.Xd.LINE_SCALE_MODE=et.F4.NORMAL;var es=v.h8.noteData,er=v.h8.horizontalLineBreak,ei=v.h8.standards,eo=v.h8.layersCombination,ea=v.h8.breakpoints,el=function e(t){var n=t.width,s=t.height,r=t.margin,o=t.timelineHeight,a=t.standardsColors,l=t.app,c=t.breakpointsApp,d=t.composerAccent,h=this;(0,i.Z)(this,e),this.destroy=function(){h.cache.columns.forEach(function(e){return e.destroy(!0)}),h.cache.standard.forEach(function(e){return e.destroy(!0)}),h.cache.columnsLarger.forEach(function(e){return e.destroy(!0)}),h.cache.standardLarger.forEach(function(e){return e.destroy(!0)}),h.cache.breakpoints.forEach(function(e){return e.destroy(!0)}),Object.entries(h.cache.notes).forEach(function(e){var t=(0,u.Z)(e,2);(t[0],t[1]).destroy(!0)}),h.app=null,h.breakpointsApp=null},this.generate=function(){v.nq.forEach(function(e){var t=h.drawColumn(e,1);t&&h.cache.columns.push(t)}),h.standardsColors.forEach(function(e){var t=h.drawColumn(e,1);t&&h.cache.standard.push(t)}),h.standardsColors.forEach(function(e){var t=h.drawColumn(e,3);t&&h.cache.standardLarger.push(t)}),eo.forEach(function(e){var t=h.noteWidth,n=h.noteHeight,s=h.noteWidth>20?3:2,r=new T.u(e),i=new et.K3;if(r.test(0)&&i.beginFill(new(ee())(es.background).rgbNumber()).lineStyle(1,new(ee())(es.background).rgbNumber()).drawRoundedRect(h.margin/2-.25,h.margin/2,Math.ceil(t-h.margin),Math.ceil(n-h.margin),s).endFill(),r.test(1)&&i.lineStyle(4===h.margin?3:2,new(ee())(es.border).rgbNumber()).drawRoundedRect(h.margin/2-.25,h.margin/2,Math.ceil(t-h.margin),Math.ceil(n-h.margin),s).endFill(),r.test(2)&&i.beginFill(new(ee())(es.center).rgbNumber()).lineStyle(1,new(ee())(es.center).rgbNumber()).drawCircle(t/2-.25,n/2,n/3-.5).endFill(),r.test(3)){var o=4===h.margin?3:2;i.lineStyle(o,new(ee())(es.border).darken(.15).rgbNumber()).moveTo(h.margin/2+.5,n/2).lineTo(t-h.margin+.5,n/2).endFill()}if(h.app){var a=h.app.renderer.generateTexture(i,{resolution:2,scaleMode:en.aH$.LINEAR,region:new en.AeJ(0,0,h.noteWidth,h.noteHeight)});h.cache.notes[e]=a,i.destroy(!0)}}),v.nq.forEach(function(e){var t=h.drawColumn(e,2);t&&h.cache.columnsLarger.push(t)}),ea.forEach(function(e){var t=new et.K3,n=h.timelineHeight/6;if("short"===e.type){if(t.beginFill(h.composerAccent.rgbNumber()),t.drawCircle(n,h.timelineHeight/2,n).endFill(),!h.breakpointsApp)return;var s=h.breakpointsApp.renderer.generateTexture(t,{scaleMode:en.aH$.LINEAR,resolution:2,region:new en.AeJ(0,0,2*n,h.timelineHeight)});h.cache.breakpoints.push(s),t.destroy(!0)}else{if(t.beginFill(h.composerAccent.rgbNumber()).moveTo(0,h.height).lineTo(h.noteWidth/2,h.height).lineTo(0,h.height-h.noteHeight).endFill(),t.beginFill(h.composerAccent.rgbNumber()).moveTo(h.width,h.height).lineTo(h.noteWidth/2,h.height).lineTo(h.width,h.height-h.noteHeight).endFill(),t.beginFill(h.composerAccent.rgbNumber()).moveTo(0,0).lineTo(h.noteWidth/2,0).lineTo(0,h.noteHeight).endFill(),t.beginFill(h.composerAccent.rgbNumber()).moveTo(h.width,0).lineTo(h.noteWidth/2,0).lineTo(h.width,h.noteHeight).endFill(),!h.app)return;var r=h.app.renderer.generateTexture(t,{scaleMode:en.aH$.LINEAR,resolution:2});h.cache.breakpoints.push(r),t.destroy(!0)}})},this.drawColumn=function(e,t){var n=new et.K3;n.beginFill(e.color),n.drawRect(0,0,h.width,h.height),n.lineStyle(t,3355443).moveTo(h.width,0).lineTo(h.width,h.height),n.lineStyle(1,3355443);for(var s=1;s<3;s++){var r=h.noteHeight*er*s;n.moveTo(0,r),n.lineTo(h.width,r)}if(h.app){var i=h.app.renderer.generateTexture(n,{scaleMode:en.aH$.LINEAR,resolution:(null==window?void 0:window.devicePixelRatio)||1,region:new en.AeJ(0,0,h.width,h.height)});return n.destroy(!0),i}},this.cache={columns:[],notes:{},standard:[],columnsLarger:[],standardLarger:[],breakpoints:[]},this.width=n,this.height=s,this.timelineHeight=void 0===o?30:o,this.margin=void 0===r?4:r,this.noteWidth=this.width,this.noteHeight=this.height/v.WO,this.standardsColors=a||ei,this.app=l,this.breakpointsApp=c,this.composerAccent=d,this.generate()},ec=n(9218),eu=n(1328);function ed(e){var t=e.notes,n=e.index,s=e.sizes,r=e.onClick,i=e.cache,o=e.instruments,a=e.backgroundCache,l=e.isBreakpoint,c=e.isSelected,u=e.isToolsSelected,d=e.currentLayer,h=(0,f.useCallback)(function(){r(n)},[n,r]);return(0,g.jsxs)(K.W2,{pointertap:h,interactive:!0,x:s.width*n,children:[(0,g.jsxs)(K.jy,{texture:a,interactiveChildren:!1,children:[(c||u)&&(0,g.jsx)(K.jy,{texture:u&&!c?i.standard[3]:i.standard[2],alpha:u&&!c?.4:.8,zIndex:1}),l&&(0,g.jsx)(K.jy,{texture:i.breakpoints[1]})]}),t.map(function(e){var t=e.layer.toLayerStatus(d,o);return 0===t?null:(0,g.jsx)(K.jy,{texture:i.notes[t],y:v.zW[e.index]*s.height/v.WO},e.index)})]})}function eh(e){var t=e.onClick,n=e.children,s=e.tooltip,r=e.style,i=e.ariaLabel;return(0,g.jsxs)("button",{className:"timeline-button ".concat((0,E.h)(s)),onClick:t,style:r,"aria-label":i,children:[n,s&&(0,g.jsx)(E.u,{children:s})]})}var em=function(e){(0,a.Z)(n,e);var t=(0,h.Z)(n);function n(e){(0,i.Z)(this,n),(s=t.call(this,e)).resetPointerDown=function(){s.stageSelected=!1,s.sliderSelected=!1,s.stagePreviousPositon=0},s.recalculateCacheAndSizes=function(){s.cacheRecalculateDebounce&&clearTimeout(s.cacheRecalculateDebounce),s.cacheRecalculateDebounce=setTimeout(function(){if((null===(e=s.notesStageRef)||void 0===e?void 0:e.current)&&(null===(t=s.breakpointsStageRef)||void 0===t?void 0:t.current)){var e,t,n=document.body.getBoundingClientRect(),r=s.state.numberOfColumnsPerCanvas,i=s.props.data.inPreview,o=(0,C.VN)(.85*n.width-45),a=(0,C.VN)(.45*n.height);"Sky"===v.iC&&(a=(0,C.VN)(.95*a)),i&&(o=(0,C.VN)(o*(n.width<900?.8:.55)),a=(0,C.VN)(a*(n.width<900?.8:.6)));var l=(0,C.VN)(o/r);s.setState({width:Math.floor(o),height:Math.floor(a),column:{width:l,height:a},cache:s.getCache(l,a,Q()()?2:4,Q()()?25:30)})}},50)},s.handleKeyboard=function(e){var t=e.code;"ArrowRight"===t?s.handleBreakpoints(1):"ArrowLeft"===t&&s.handleBreakpoints(-1)},s.handleWheel=function(e){s.props.functions.selectColumn(s.props.data.selected+Math.sign(e.deltaY),!0)},s.handleClick=function(e,t){var n=e.data.global.x,r=s.state,i=r.width,o=r.numberOfColumnsPerCanvas,a=s.props.data;if("up"===t&&(s.sliderSelected=!1),"down"===t){s.sliderSelected=!0;var l=i/a.columns.length,c=l*(o+1),u=l*a.selected-o/2*l;s.onSlider=n>u&&n<u+c,s.sliderOffset=u+c/2-n,s.throttleScroll=Number.MAX_SAFE_INTEGER,s.handleSlide(e)}"downStage"===t&&(s.stagePreviousPositon=n,s.stageSelected=!0)},s.handleStageSlide=function(e){var t=e.data.global.x;if(!0===s.stageSelected){if(s.throttleScroll++<5)return;s.throttleScroll=0;var n=s.props,r=n.data,i=n.functions,o=(0,C.uZ)(Math.ceil(Math.abs(s.stagePreviousPositon-t)/8),0,4),a=s.stagePreviousPositon<t?-1:1;s.stagePreviousPositon=t;var l=r.selected+a*o;if(r.selected===l)return;i.selectColumn((0,C.uZ)(l,0,r.columns.length-1),!0)}},s.handleBreakpoints=function(e){var t=s.props.data,n=t.selected,r=t.columns,i=t.breakpoints,o=1===e?i.filter(function(e){return e>n}).sort(function(e,t){return e-t}):i.filter(function(e){return e<n}).sort(function(e,t){return t-e});0!==o.length&&r.length>=o[0]&&o[0]>=0&&s.props.functions.selectColumn(o[0])},s.handleSlide=function(e){var t=e.data.global.x;if(s.sliderSelected){if(s.throttleScroll++<4)return;var n=s.state,r=n.width,i=n.column,o=s.props.data;s.hasSlided=!0,s.throttleScroll=0;var a=i.width*o.columns.length,l=Math.floor((s.onSlider?t+s.sliderOffset:t)/r*a/i.width);s.props.functions.selectColumn(l,!0)}};var s,r=Number(s.props.data.settings.columnsPerCanvas.value);return s.state={width:Math.floor(300),height:Math.floor(150),pixelRatio:1.4,numberOfColumnsPerCanvas:r,column:{width:(0,C.VN)(300/r),height:150},timelineHeight:30,currentBreakpoint:-1,theme:{timeline:{hex:N.f6.layer("primary",.1).toString(),hexNumber:N.f6.layer("primary",.1).rgbNumber(),selected:N.f6.get("composer_accent").negate().rgbNumber(),border:N.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:N.f6.get("primary").darken(.08).toString(),rgb:N.f6.get("primary").darken(.08).rgb().array().map(function(e){return Math.floor(e)}).join(",")}},cache:null},s.notesStageRef=(0,f.createRef)(),s.breakpointsStageRef=(0,f.createRef)(),s.stageSelected=!1,s.sliderSelected=!1,s.hasSlided=!1,s.stagePreviousPositon=0,s.sliderOffset=0,s.throttleScroll=0,s.onSlider=!1,s.dispose=function(){},s.cacheRecalculateDebounce=0,s}var s=n.prototype;return s.componentDidMount=function(){var e,t,n,s,r=this,i=this.state.numberOfColumnsPerCanvas,o=document.body.getBoundingClientRect(),a=(0,C.VN)(.85*o.width-45),l=(0,C.VN)(.45*o.height);"Sky"===v.iC&&(l=(0,C.VN)(.95*l)),this.setState({width:Math.floor(a),height:Math.floor(l),pixelRatio:null!==(s=window.devicePixelRatio)&&void 0!==s?s:1.4,numberOfColumnsPerCanvas:i,column:{width:(0,C.VN)(a/i),height:l},timelineHeight:Q()()?25:30},function(){window.addEventListener("resize",r.recalculateCacheAndSizes),r.recalculateCacheAndSizes()}),window.addEventListener("pointerup",this.resetPointerDown),eu.w.listen(this.handleKeyboard),null===(e=this.notesStageRef)||void 0===e||null===(t=e.current)||void 0===t||null===(n=t._canvas)||void 0===n||n.addEventListener("wheel",this.handleWheel),this.dispose=(0,D.B)(function(){r.recalculateCacheAndSizes(),r.setState({theme:{timeline:{hex:N.f6.layer("primary",.1).toString(),hexNumber:N.f6.layer("primary",.1).rgbNumber(),selected:N.f6.get("composer_accent").negate().rgbNumber(),border:N.f6.get("composer_accent").rgbNumber()},sideButtons:{hex:N.f6.get("primary").darken(.08).toString(),rgb:N.f6.get("primary").darken(.08).rgb().array().map(function(e){return Math.floor(e)}).join(",")}}})})},s.componentWillUnmount=function(){var e,t,n,s;window.removeEventListener("pointerup",this.resetPointerDown),window.removeEventListener("resize",this.recalculateCacheAndSizes),this.cacheRecalculateDebounce&&clearTimeout(this.cacheRecalculateDebounce),eu.w.unlisten(this.handleKeyboard),null===(e=this.notesStageRef)||void 0===e||null===(t=e.current)||void 0===t||null===(n=t._canvas)||void 0===n||n.removeEventListener("wheel",this.handleWheel),this.dispose(),null===(s=this.state.cache)||void 0===s||s.destroy(),this.notesStageRef=null,this.breakpointsStageRef=null},s.getCache=function(e,t,n,s){var r,i,o,a,l={l:N.f6.get("primary"),d:N.f6.get("primary")};if(l.l=.05>l.l.luminosity()?l.l.lighten(.4):l.l.lighten(.1),l.d=.05>l.d.luminosity()?l.d.lighten(.15):l.d.darken(.03),!(null===(r=this.notesStageRef)||void 0===r?void 0:r.current)||!(null===(i=this.breakpointsStageRef)||void 0===i?void 0:i.current))return null;var c=new el({width:e,height:t,margin:n,timelineHeight:s,app:this.notesStageRef.current.app,breakpointsApp:this.breakpointsStageRef.current.app,composerAccent:N.f6.get("composer_accent").rotate(20).darken(.5),standardsColors:[{color:l.l.rgbNumber()},{color:l.d.rgbNumber()},{color:N.f6.get("composer_accent").rgbNumber()},{color:N.f6.get("composer_accent").negate().rgbNumber()}]});return null===(o=this.state.cache)||void 0===o||null===(a=o.destroy)||void 0===a||a.call(o),c},s.render=function(){var e,t=this,n=this.state,s=n.width,r=n.timelineHeight,i=n.height,o=n.theme,a=n.numberOfColumnsPerCanvas,l=n.pixelRatio,c=this.props,u=c.data,d=c.functions,h=null===(e=this.state.cache)||void 0===e?void 0:e.cache,m=this.state.column,f=-((u.selected-a/2+1)*m.width),v=Number(u.settings.beatMarks.value),x=0===v?12:4*v,y=s/u.columns.length,b=Math.floor(y*(s/m.width+1)),j=y*u.selected-y*(a/2),C=u.breakpoints.includes(u.selected),w=o.sideButtons.rgb;return(0,g.jsxs)("div",{className:"canvas-wrapper",style:{width:s},children:[(0,g.jsxs)("div",{className:"canvas-relative",children:[!u.settings.useKeyboardSideButtons.value&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{onPointerDown:function(){return d.selectColumn(u.selected-1)},className:"canvas-buttons ".concat(u.isPlaying?"":"canvas-buttons-visible"),style:{left:"0",paddingRight:"0.5rem",justifyContent:"flex-start",background:"linear-gradient(90deg, rgba(".concat(w,",0.80) 30%, rgba(").concat(w,",0.30) 80%, rgba(").concat(w,",0) 100%)")},children:(0,g.jsx)(p.bUI,{})}),(0,g.jsx)("button",{onPointerDown:function(){return d.selectColumn(u.selected+1)},className:"canvas-buttons ".concat(u.isPlaying?"":"canvas-buttons-visible"),style:{right:"0",paddingLeft:"0.5rem",justifyContent:"flex-end",background:"linear-gradient(270deg, rgba(".concat(w,",0.80) 30%, rgba(").concat(w,",0.30) 80%, rgba(").concat(w,",0) 100%)")},children:(0,g.jsx)(p.Dli,{})})]}),(0,g.jsx)(K.Hf,{width:s,height:i,raf:!1,renderOnComponentChange:!0,options:{backgroundAlpha:0,autoDensity:!0,resolution:l},ref:this.notesStageRef,children:h&&!u.isRecordingAudio&&(0,g.jsx)(K.W2,{x:f,interactive:!0,pointerdown:function(e){return t.handleClick(e,"downStage")},pointermove:this.handleStageSlide,children:u.columns.map(function(e,t){if(!((n=u.selected)-(s=a/2+2)<t)||!(t<n+s))return null;var n,s,r=(t+1)%4==0?h.columnsLarger:h.columns,i=(t+1)%4==0?h.standardLarger:h.standard,o=0===e.tempoChanger?i[Number(t%(2*x)>=x)]:r[e.tempoChanger];return(0,g.jsx)(ed,{cache:h,notes:e.notes,index:t,sizes:m,instruments:u.song.instruments,currentLayer:u.currentLayer,backgroundCache:o,isToolsSelected:u.selectedColumns.includes(t),onClick:d.selectColumn,isSelected:t===u.selected,isBreakpoint:u.breakpoints.includes(t)},t)})})})]}),(0,g.jsxs)("div",{className:"timeline-wrapper",style:{height:this.state.timelineHeight},children:[(0,g.jsx)(eh,{onClick:function(){return t.handleBreakpoints(-1)},tooltip:"Previous Breakpoint",style:{backgroundColor:o.timeline.hex},ariaLabel:"Previous Breakpoint",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.qSR,{size:16})})}),(0,g.jsx)(eh,{onClick:function(){return t.handleBreakpoints(1)},tooltip:"Next breakpoint",style:{marginLeft:0,backgroundColor:o.timeline.hex},ariaLabel:"Next Breakpoint",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.Nqc,{size:16})})}),(0,g.jsx)("div",{className:"timeline-scroll",style:{backgroundColor:o.timeline.hex},children:(0,g.jsxs)(K.Hf,{width:s,height:r,options:{backgroundAlpha:0,autoDensity:!0,resolution:l},raf:!1,ref:this.breakpointsStageRef,renderOnComponentChange:!0,children:[h&&(0,g.jsxs)(K.W2,{width:s,height:r,interactive:!0,pointerdown:function(e){return t.handleClick(e,"down")},pointerup:function(e){return t.handleClick(e,"up")},pointermove:this.handleSlide,children:[(0,g.jsx)(K.TC,{draw:function(e){e.clear(),e.beginFill(o.timeline.hexNumber),e.drawRect(0,0,s,r)}}),u.selectedColumns.length?(0,g.jsx)(K.TC,{draw:function(e){var t=u.selectedColumns[0]||0,n=u.selectedColumns[u.selectedColumns.length-1],s=t*y;e.clear(),e.beginFill(o.timeline.selected,.6),e.drawRect(s,0,n*y-s,r)}}):null,u.breakpoints.map(function(e){return(0,g.jsx)(K.jy,{texture:h.breakpoints[0],anchor:[.5,0],x:s/(u.columns.length-1)*e},e)})]}),(0,g.jsx)(K.TC,{draw:function(e){e.clear(),e.lineStyle(3,o.timeline.border,.8),e.drawRoundedRect(0,0,b,r-3,6)},x:j,y:1.5})]})}),(0,g.jsx)(eh,{onClick:d.toggleBreakpoint,style:{backgroundColor:o.timeline.hex},tooltip:C?"Remove breakpoint":"Add breakpoint",ariaLabel:C?"Remove breakpoint":"Add breakpoint",children:(0,g.jsx)(ec.Z,{children:C?(0,g.jsx)(p.wbB,{size:16},"minus"):(0,g.jsx)(p.EIY,{size:16},"plus")})})]})]})},n}(f.Component),eg=n(7671),ef=n(781),ep=n(7362),ev=n(5453),ex=n(125),ey=n(1108),eb=n(750),ej=n(1866),eC=n(4931),ew=n(2650),ek=n(8434),eS=n(7008),eN=n(7053),eZ=n(2132),eR=n(1182),eT=n(2881),eP=["vsrg"];function eA(e){var t,n=e.data,s=e.functions,i=e.theme,o=e.folders,a=s.removeSong,l=s.toggleMenu,c=s.renameSong,d=s.loadSong,h=s.downloadSong,v={backgroundColor:i.layer("primary",.15).hex()},x=(0,u.Z)((0,f.useState)(!1),2),y=x[0],b=x[1],j=(0,u.Z)((0,f.useState)(n.name),2),C=j[0],w=j[1];return((0,f.useEffect)(function(){w(n.name)},[n.name]),"vsrg"===n.type)?(0,g.jsx)("div",{className:"row",children:"Invalid song"}):(0,g.jsxs)("div",{className:"song-row",children:[(0,g.jsxs)("div",{className:"song-name ".concat((0,E.h)(!0)),onClick:(0,r.Z)(function(){var e;return(0,m.__generator)(this,function(t){switch(t.label){case 0:if(y)return[2];return S.kg.showPill("Loading song..."),[4,eR.v.getOneSerializedFromStorable(n)];case 1:if(e=t.sent(),S.kg.hidePill(),!e)return[2,S.kg.error("Could not find song")];return d(e),l(!1),[2]}})}),children:[y?(0,g.jsx)("input",{className:"song-name-input ".concat(y?"song-rename":""),disabled:!y,onChange:function(e){return w(e.target.value)},style:{width:"100%",color:"var(--primary-text)"},value:C}):(0,g.jsx)("div",{style:{marginLeft:"0.3rem"},children:C}),(0,g.jsx)(E.u,{children:y?"Song name":"Open in composer"})]}),(0,g.jsx)("div",{className:"song-buttons-wrapper",children:(0,g.jsxs)(ey.Rk,{Icon:p.LCi,ignoreClickOutside:y,style:v,tooltip:"More options",onClose:function(){return b(!1)},children:[(0,g.jsxs)(H.J,{className:"row row-centered",style:{padding:"0.4rem"},onClick:function(){y&&(c(C,n.id),b(!1)),b(!y)},children:[(0,g.jsx)(p.tU3,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:y?"Save":"Rename"})]}),(0,g.jsxs)(ey.tc,{style:{padding:"0 0.4rem"},children:[(0,g.jsx)(p.$nz,{style:{marginRight:"0.4rem"}}),(0,g.jsxs)("select",{className:"dropdown-select",value:n.folderId||"_None",onChange:(t=(0,r.Z)(function(e){var t,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:return t=e.target.value,[4,eR.v.getOneSerializedFromStorable(n)];case 1:if(!(s=r.sent()))return[2,S.kg.error("Could not find song")];return ew.k.addSongToFolder(s,"_None"!==t?t:null),[2]}})}),function(e){return t.apply(this,arguments)}),children:[(0,g.jsx)("option",{value:"_None",children:"None"}),o.map(function(e){return(0,g.jsx)("option",{value:e.id,children:e.name},e.id)})]})]}),(0,g.jsxs)(ey.tc,{style:{width:"100%"},onClick:(0,r.Z)(function(){var e;return(0,m.__generator)(this,function(t){switch(t.label){case 0:return(null==n?void 0:n.type)==="recorded"&&S.kg.warn("Converting recorded song to composed, audio might not be accurate"),[4,eR.v.getOneSerializedFromStorable(n)];case 1:if(!(e=t.sent()))return[2,S.kg.error("Could not find song")];return d(e),l(!1),[2]}})}),children:[(0,g.jsx)(p.fmQ,{style:{marginRight:"0.4rem"},size:14}),(0,g.jsx)(ey.Qr,{text:"Edit song"})]}),(0,g.jsxs)(ey.tc,{onClick:(0,r.Z)(function(){var e;return(0,m.__generator)(this,function(t){switch(t.label){case 0:return[4,eR.v.getOneSerializedFromStorable(n)];case 1:if(!(e=t.sent()))return[2,S.kg.error("Could not find song")];return h(e),[2]}})}),children:[(0,g.jsx)(p.aBF,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Download"})]}),("recorded"===n.type||"composed"===n.type)&&(0,g.jsxs)(ey.tc,{onClick:(0,r.Z)(function(){return(0,m.__generator)(this,function(e){switch(e.label){case 0:return[4,eR.v.fromStorableSong(n)];case 1:return h(e.sent().toMidi()),[2]}})}),children:[(0,g.jsx)(p.aBF,{style:{marginRight:"0.4rem"},size:14}),(0,g.jsx)(ey.Qr,{text:"Download MIDI"})]}),(0,g.jsxs)(ey.tc,{onClick:(0,r.Z)(function(){var e;return(0,m.__generator)(this,function(t){switch(t.label){case 0:return[4,eR.v.fromStorableSong(n)];case 1:return e=t.sent(),[4,ew.k.addSong(e)];case 2:return t.sent(),S.kg.log("Cloned song: ".concat(n.name)),l(!1),[2]}})}),children:[(0,g.jsx)(p.d_e,{style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Clone song"})]}),(0,g.jsxs)(ey.tc,{onClick:function(){return a(n.name,n.id)},children:[(0,g.jsx)(p.Xm5,{color:"#ed4557",style:{marginRight:"0.4rem"}}),(0,g.jsx)(ey.Qr,{text:"Delete"})]})]})})]})}var eL=(0,f.memo)(function(e){var t,n,s,i=e.data,o=e.functions,a=(0,u.Z)((0,f.useState)(!1),2),l=a[0],c=a[1],d=(0,u.Z)((0,f.useState)(!1),2),h=d[0],x=d[1],y=(0,u.Z)((0,eS.n)(),1)[0],C=(0,u.Z)((0,eC.j)(),1)[0],w=(0,u.Z)((0,f.useState)("Settings"),2),N=w[0],Z=w[1],R=o.loadSong,T=o.changePage,A=o.renameSong,L=o.handleSettingChange,I=o.changeVolume,_=o.createNewSong,E=o.changeMidiVisibility,M=o.updateThisSong,B=(0,u.Z)((0,D.F)(),1)[0],O=(0,eN.ZP)(function(e){v.q$?x(!1):c(!1)},{active:l&&h,ignoreFocusable:!0});(0,f.useEffect)(function(){return eu.w.register("Escape",function(){x(!1)},{id:"composer_menu"}),function(){return eu.w.unregisterById("composer_menu")}},[]);var F=(0,f.useCallback)(function(e){"boolean"!=typeof e&&(e=void 0),x(function(t){return void 0!==e?e:!t})},[]),V=(0,f.useCallback)((t=(0,r.Z)(function(e,t){return(0,m.__generator)(this,function(n){switch(n.label){case 0:return[4,(0,eb.jH)("Are you sure you want to delete the song: "+e)];case 1:if(!n.sent())return[3,3];return[4,ew.k.removeSong(t)];case 2:n.sent(),ev.Z.userSongs("delete",{name:e,page:"composer"}),n.label=3;case 3:return[2]}})}),function(e,n){return t.apply(this,arguments)}),[]),z=(0,f.useCallback)((0,r.Z)(function(){var e;return(0,m.__generator)(this,function(t){switch(t.label){case 0:return[4,(0,eb.cJ)("Write the folder name")];case 1:if(!(e=t.sent()))return[2];return ek.p.createFolder(e),[2]}})}),[]),W=(0,f.useCallback)(function(e){if(e===N&&l)return c(!1);c(!0),e&&(Z(e),ev.Z.UIEvent("menu",{tab:e}))},[l,N]),J=(0,f.useCallback)((n=(0,r.Z)(function(e){var t,n,s,r,i,o,a,l,c,u,d;return(0,m.__generator)(this,function(h){switch(h.label){case 0:t=!0,n=!1,s=void 0,h.label=1;case 1:h.trys.push([1,8,9,10]),r=e[Symbol.iterator](),h.label=2;case 2:if(t=(i=r.next()).done)return[3,7];o=i.value,h.label=3;case 3:return h.trys.push([3,5,,6]),a=Array.isArray(o.data)?o.data:[o.data],[4,eZ.bV.importAndLog(a)];case 4:return h.sent(),[3,6];case 5:if(console.error(l=h.sent()),null===(u=(c=o.file.name).includes)||void 0===u?void 0:u.call(c,".mid"))return[2,S.kg.error("Midi files should be imported in the composer")];return l&&console.error(l),S.kg.error("Error importing file, invalid format",8e3),[3,6];case 6:return t=!0,[3,2];case 7:return[3,10];case 8:return d=h.sent(),n=!0,s=d,[3,10];case 9:try{t||null==r.return||r.return()}finally{if(n)throw s}return[7];case 10:return[2]}})}),function(e){return n.apply(this,arguments)}),[]),U=(0,f.useCallback)((s=(0,r.Z)(function(e){var t,n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:if(r.trys.push([0,3,,4]),!(e instanceof j.Midi))return[3,2];return[4,(0,eb.jH)("If you use MIDI, the song will loose some information, if you want to share the song with others, use the other format (button above). Do you still want to download?")];case 1:if(!r.sent())return[2];return[2,eZ.bV.downloadMidi(e)];case 2:return e.data.appName=v.iC,t=e.name,n=eR.v.parseSong(e),s=["Sky"===v.iC&&(n instanceof k.l||n instanceof eT.M)?n.toOldFormat():n.serialize()],eZ.bV.downloadSong(s,"".concat(t,".").concat(v.iC.toLowerCase(),"sheet")),S.kg.success("Song downloaded"),ev.Z.userSongs("download",{name:n.name,page:"composer"}),[3,4];case 3:return console.log(r.sent()),S.kg.error("Error downloading song"),[3,4];case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),[]),X=i.hasChanges?"margin-top-auto not-saved":"margin-top-auto";return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{className:"hamburger",onClick:function(){return x(!h)},children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.Fm7,{})})}),(0,g.jsxs)("div",{className:"menu-wrapper",ref:O,children:[(0,g.jsxs)("div",{className:h?"menu menu-visible":"menu",children:[(0,g.jsx)(eg.s,{onClick:function(){return F()},className:"close-menu",ariaLabel:"Close menu",children:(0,g.jsx)(p.aHS,{className:"icon"})}),(0,g.jsx)(eg.s,{onClick:M,className:X,ariaLabel:"Save",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.TvB,{className:"icon"})})}),(0,g.jsx)(eg.s,{onClick:function(){return W("Songs")},isActive:l&&"Songs"===N,ariaLabel:"Song menu",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.HcQ,{className:"icon"})})}),(0,g.jsx)(eg.s,{onClick:function(){return W("Settings")},isActive:l&&"Settings"===N,ariaLabel:"Settings menu",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.p4t,{className:"icon"})})}),(0,g.jsx)(eg.s,{onClick:function(){return T("Home")},ariaLabel:"Open home menu",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.xng,{className:"icon"})})})]}),(0,g.jsxs)("div",{className:l&&h?"side-menu menu-open":"side-menu",children:[(0,g.jsxs)(ef.Z,{current:N,id:"Songs",children:[(0,g.jsxs)("div",{className:"songs-buttons-wrapper",children:[(0,g.jsx)(P.k,{children:(0,g.jsxs)("ul",{children:[(0,g.jsx)("li",{children:"Click the song name to load it"}),(0,g.jsx)("li",{children:"You can use different instruments for each layer"}),(0,g.jsx)("li",{children:"Tempo changers help you make faster parts of a song without having very high bpm"}),(0,g.jsx)("li",{children:"You can quickly create a song by importing a MIDI file and editing it"}),(0,g.jsx)("li",{children:"You can add breakpoints to the timeline (the bar below the composer) to quickly jump between parts of a song"})]})}),(0,g.jsx)(H.J,{onClick:function(){E(!0),F()},style:{marginLeft:"auto"},children:"Create from MIDI"}),(0,g.jsx)(H.J,{onClick:_,children:"Create new song"})]}),(0,g.jsx)(ex.G,{songs:y,exclude:eP,SongComponent:eA,style:{marginTop:"0.6rem"},componentProps:{theme:B,folders:C,functions:{loadSong:R,removeSong:V,toggleMenu:F,downloadSong:U,renameSong:A}}}),(0,g.jsxs)("div",{className:"row",style:{justifyContent:"flex-end",gap:"0.2rem"},children:[(0,g.jsx)(b.G,{onPick:J,onError:function(e,t){e&&console.error(e);var n=null==t?void 0:t.some(function(e){var t;return null==e?void 0:null===(t=e.name)||void 0===t?void 0:t.endsWith(".mid")}),s=(null==t?void 0:t.length)===1;n&&s?(S.kg.warn("Opening the midi importer to import a MIDI file, please reselect the file",6e3),E(!0),F()):S.kg.error('Error importing file, invalid format, if it\'s a MIDI file, use the "Create from MIDI" button',8e3)},as:"json",multiple:!0,children:(0,g.jsx)(H.J,{children:"Import song sheet"})}),(0,g.jsx)(H.J,{onClick:z,children:"Create folder"})]}),(0,g.jsx)("div",{className:"songs-buttons-wrapper",style:{marginTop:"auto"},children:(0,g.jsx)(H.J,{style:{marginTop:"0.5rem"},className:"record-btn",onClick:function(){return o.startRecordingAudio(!i.isRecordingAudio)},toggled:i.isRecordingAudio,children:i.isRecordingAudio?"Stop recording audio":"Start recording audio"})})]}),(0,g.jsxs)(ef.Z,{current:N,id:"Settings",children:[(0,g.jsx)(ej.A,{settings:i.settings,onUpdate:L,changeVolume:I}),(0,g.jsxs)("div",{className:"settings-row-wrap",children:[v.DR&&(0,g.jsx)(H.J,{onClick:function(){return T("MidiSetup")},style:{width:"fit-content"},children:"Connect MIDI keyboard"}),(0,g.jsx)(H.J,{onClick:function(){return T("Theme")},style:{width:"fit-content"},children:"Change app theme"})]}),(0,g.jsx)(ep.Z,{})]})]})]})]})},function(e,t){return e.data.settings===t.data.settings&&e.data.hasChanges===t.data.hasChanges&&e.data.isRecordingAudio===t.data.isRecordingAudio}),eI=n(5839),e_=n(9788),eE=n(2809),eM=n(6138),eB=n(7557);function eO(e){var t=e.children,n=e.tooltip,s=e.onClick,r=e.style,i=e.ariaLabel;return(0,g.jsxs)("button",{className:"tool ".concat((0,E.h)(n)),onClick:s,style:r,"aria-label":i,children:[t,n&&(0,g.jsx)(E.u,{children:n})]})}var eH=n(5684),eD=n(7516),eF=n(5736),eV=["circle","border","line"];function ez(e){var t=e.instrument,n=e.onChange,s=e.onDelete,r=e.onClose,i=e.onChangePosition,o=e.currentLayer,a=e.instruments,c=(0,eN.ZP)(r,{active:!0,ignoreFocusable:!0});return t?(0,g.jsxs)("div",{className:"floating-instrument-settings box-shadow",ref:c,children:[(0,g.jsxs)("div",{className:"row space-between",children:["Layer name",(0,g.jsx)("input",{type:"text",maxLength:50,className:"input",style:{width:"7.4rem"},value:t.alias,onChange:function(e){return n(t.set({alias:e.target.value}))},placeholder:t.name})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Instrument",(0,g.jsx)(eF.O,{style:{width:"8rem"},selected:t.name,onChange:function(e){return n(t.set({name:e}))}})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Pitch",(0,g.jsx)(A.x,{style:{padding:"0.3rem",width:"8rem"},selected:t.pitch,onChange:function(e){return n(t.set({pitch:e}))},children:(0,g.jsx)("option",{value:"",children:"Use song pitch"})})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:["Note icon",(0,g.jsx)("select",{className:"select",style:{padding:"0.3rem",width:"8rem"},value:t.icon,onChange:function(e){return n(t.set({icon:e.target.value}))},children:eV.map(function(e){return(0,g.jsx)("option",{value:e,children:(0,C.kC)(e)},e)})})]}),(0,g.jsxs)("div",{className:"row",style:{marginTop:"1rem",alignItems:"center"},children:["Volume",(0,g.jsxs)("span",{style:(0,l.Z)({marginLeft:"0.4rem",width:"3rem"},t.volume>100&&{color:"hsl(0, ".concat(-40+t.volume,"%, 61%)"),marginLeft:"0.4rem"}),children:[t.volume,"%"]}),(0,g.jsx)(P.k,{buttonStyle:{width:"1.2rem",height:"1.2rem"},width:10,children:"If you hear distortion, reduce the volume"})]}),(0,g.jsxs)("div",{className:"row",children:[(0,g.jsx)("input",{type:"range",style:{flex:"1",opacity:t.muted?"0.6":"1"},min:0,max:125,value:t.volume,onChange:function(e){return n(t.set({volume:Number(e.target.value)}))}}),(0,g.jsx)(H.J,{className:"flex-centered",toggled:t.muted,style:{padding:0,minWidth:"unset",width:"1.6rem",height:"1.6rem",borderRadius:"2rem"},onClick:function(){(0!==t.volume||t.muted)&&n(t.set({muted:!t.muted}))},children:t.muted||0===t.volume?(0,g.jsx)(p.xZH,{}):(0,g.jsx)(p.rxG,{})})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"1rem"},children:[(0,g.jsxs)(H.J,{onClick:function(){return i(-1)},disabled:0===o,className:"flex-centered",style:{padding:"0.5rem",flex:"1",marginRight:"0.4rem"},children:[(0,g.jsx)(p.ZTc,{style:{marginRight:"0.2rem"}})," Move up"]}),(0,g.jsxs)(H.J,{onClick:function(){return i(1)},disabled:o===a.length-1,className:"flex-centered",style:{padding:"0.5rem",flex:"1"},children:[(0,g.jsx)(p.NWQ,{style:{marginRight:"0.2rem"}})," Move down"]})]}),(0,g.jsxs)("div",{className:"row space-between",style:{marginTop:"0.4rem"},children:[(0,g.jsxs)(H.J,{className:"row-centered",style:{padding:"0.4rem",width:"fit-content"},onClick:s,children:[(0,g.jsx)(p.Xm5,{color:"var(--red)",style:{marginRight:"0.3rem"}}),"Delete"]}),(0,g.jsx)(H.J,{onClick:r,style:{padding:"0.4rem",width:"fit-content"},children:"Ok"})]})]}):(0,g.jsx)("div",{className:"floating-instrument-settings  box-shadow",children:"No instrument selected"})}var eW=(0,f.memo)(function(e){var t=e.instruments,n=e.onInstrumentAdd,s=e.onInstrumentChange,r=e.onInstrumentDelete,i=e.selected,o=e.onLayerSelect,a=e.onChangePosition,l=(0,u.Z)((0,D.F)(),1)[0],c=(0,u.Z)((0,f.useState)(!1),2),d=c[0],h=c[1],m=(0,f.useCallback)(function(){h(!1)},[]);return(0,g.jsxs)(g.Fragment,{children:[d&&(0,g.jsx)(ez,{instrument:t[i],currentLayer:i,instruments:t,onChange:function(e){return s(e,i)},onDelete:function(){r(i),m()},onChangePosition:a,onClose:m}),(0,g.jsxs)("div",{className:"column instruments-button-wrapper",children:[t.map(function(e,t){return(0,g.jsx)(eJ,{theme:l,instrument:e,isSelected:t===i,onEditClick:function(){return h(!d)},onClick:function(){return o(t)},onVisibleToggle:function(n){return s(e.set({visible:n}),t)}},e.name+t)}),(0,g.jsx)("div",{style:{minHeight:"1rem"}}),(0,g.jsx)(H.J,{onClick:function(e){n(),setTimeout(function(){var t;null===(t=e.target)||void 0===t||t.scrollIntoView()},50)},ariaLabel:"Add new instrument",className:"new-instrument-button flex-centered",children:(0,g.jsx)(p.wEH,{size:16,color:"var(--icon-color)"})})]})]})},function(e,t){return e.instruments===t.instruments&&e.selected===t.selected});function eJ(e){var t=e.instrument,n=e.onClick,s=e.isSelected,r=e.theme,i=e.onEditClick,o=e.onVisibleToggle,a=(0,f.useRef)(null);(0,f.useEffect)(function(){s&&a.current&&a.current.scrollIntoView({behavior:"auto",block:"nearest"})},[s,a]);var l=r.getText("primary");return l=l.isDark()?l.lighten(.2):l.darken(.15),(0,g.jsxs)("div",{ref:a,className:"instrument-button flex-centered ".concat(s?"instrument-button-selected":""),style:s?{backgroundColor:r.get("primary").mix(r.get("accent")).toString()}:{},children:[!s&&(0,g.jsxs)("div",{className:"row",style:{position:"absolute",gap:"0.2rem",top:"0.2rem",left:"0.3rem"},children:[!t.visible&&(0,g.jsx)(p.tgn,{color:l.hex(),size:14}),t.muted&&(0,g.jsx)(p.xZH,{color:l.hex(),size:14})]}),!s&&(0,g.jsxs)("div",{style:{position:"absolute",top:"0.4rem",right:"0.4rem",height:"fit-content"},children:["circle"===t.icon&&(0,g.jsx)(p.gbA,{size:8,style:{display:"block"},color:l.hex()}),"border"===t.icon&&(0,g.jsx)(eD.orY,{size:12,style:{display:"block",marginRight:"-2px",marginTop:"-2px",strokeWidth:"2px"},color:l.hex()}),"line"===t.icon&&(0,g.jsx)(p.iFH,{size:8,style:{display:"block"},color:l.hex()})]}),(0,g.jsx)(H.J,{onClick:n,style:{backgroundColor:"transparent",width:"100%"},className:"flex-grow flex-centered instrument-name-button",children:(0,g.jsx)("span",{className:"text-ellipsis",style:{width:"6rem"},children:t.alias||t.name})}),s&&(0,g.jsxs)("div",{className:"instrument-settings",children:[(0,g.jsx)(H.J,{onClick:function(){return i()},ariaLabel:"Settings",className:"flex-centered",children:(0,g.jsx)(p.p4t,{size:15})}),(0,g.jsx)(H.J,{onClick:function(){return o(!t.visible)},ariaLabel:t.visible?"Hide":"Show",className:"flex-centered",children:t.visible?(0,g.jsx)(p.dSq,{size:16}):(0,g.jsx)(p.tgn,{size:16})})]})]})}var eU=n(4995),eX=n(1163),eY=function(e){(0,a.Z)(n,e);var t=(0,h.Z)(n);function n(e){(0,i.Z)(this,n),(Z=t.call(this,e)).unblock=function(){};var o,a,h,g,f,p,x,y,b,j,w,Z,R=(0,s.Z)(Z);Z.init=(o=(0,r.Z)(function(e){var t,n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:return[4,R.syncInstruments()];case 1:r.sent(),eB.n.setReverb(e.caveMode.value),eM.mP.addListener(R.handleMidi),R.registerKeyboardListeners(),r.label=2;case 2:if(r.trys.push([2,4,,5]),!(t=R.props.songId))return[2];return[4,eR.v.getSongById(t)];case 3:if(!(n=r.sent()))return[2];return R.loadSong(n),[3,5];case 4:return s=r.sent(),console.log("Error loading song"),console.error(s),[3,5];case 5:return[2]}})}),function(e){return o.apply(this,arguments)}),Z.registerKeyboardListeners=function(){var e="composer";eu.w.registerLetter("D",function(){Z.state.isPlaying||Z.selectColumn(Z.state.song.selected+1)},{id:e}),eu.w.registerLetter("A",function(){Z.state.isPlaying||Z.selectColumn(Z.state.song.selected-1)},{id:e}),eu.w.registerLetter("Q",function(){Z.state.isPlaying||Z.removeColumns(1,Z.state.song.selected)},{id:e}),eu.w.registerLetter("E",function(){Z.state.isPlaying||Z.addColumns(1,Z.state.song.selected)},{id:e}),v.nq.forEach(function(t,n){eu.w.registerNumber(n+1,function(){return Z.handleTempoChanger(t)},{id:e})}),eu.w.register("ArrowUp",function(){var e=Z.state.layer-1;e>=0&&Z.changeLayer(e)},{id:e}),eu.w.register("ArrowDown",function(){var e=Z.state.layer+1;e<Z.state.layers.length&&Z.changeLayer(e)},{id:e}),eu.w.register("Space",function(e){var t,n,s,r,i=e.event;!i.repeat&&((null===(t=i.target)||void 0===t?void 0:t.tagName)==="BUTTON"&&(null===(n=i.target)||void 0===n||n.blur()),Z.togglePlay(),Z.state.settings.syncTabs.value&&(null===(s=Z.broadcastChannel)||void 0===s||null===(r=s.postMessage)||void 0===r||r.call(s,Z.state.isPlaying?"play":"stop")))},{id:e}),eu.w.listen(function(e){var t=e.event,n=e.letter;if(!t.repeat&&(Z.state.isPlaying||t.shiftKey)){var s=Z.currentInstrument.getNoteFromCode(n);null!==s&&Z.handleClick(s)}},{id:e})},Z.handleUnload=function(e){e.preventDefault(),e.returnValue=""},Z.handleAutoSave=function(){Z.changes++,Z.changes>5&&Z.state.settings.autosave.value&&"Untitled"!==Z.state.song.name&&Z.updateSong(Z.state.song)},Z.handleMidi=function(e){var t=(0,u.Z)(e,3),n=t[0],s=t[1],r=t[2];if(Z.mounted){var i=Z.state,o=i.song,a=i.layer;if(eM.mP.isDown(n)&&0!==r){eM.mP.settings.notes.filter(function(e){return e.midi===s}).forEach(function(e){Z.handleClick(Z.currentInstrument.notes[e.index])});var l=eM.mP.settings.shortcuts.find(function(e){return e.midi===s});if(!l)return;switch(l.type){case"toggle_play":Z.togglePlay();break;case"next_column":Z.selectColumn(o.selected+1);break;case"previous_column":Z.selectColumn(o.selected-1);break;case"add_column":Z.addColumns(1,o.selected);break;case"remove_column":Z.removeColumns(1,o.selected);break;case"change_layer":var c=a+1;c>=Z.state.layers.length&&(c=0),Z.changeLayer(c)}}}},Z.updateSettings=function(e){eH.j.updateComposerSettings(void 0!==e?e:Z.state.settings)},Z.handleSettingChange=function(e){var t=e.data,n=e.key,s=Z.state,r=s.song,i=s.settings;i[n]=(0,c.Z)((0,l.Z)({},i[n]),{value:t.value}),t.songSetting&&(r[n]=t.value),"caveMode"===n&&eB.n.setReverb(t.value),Z.setState({settings:(0,l.Z)({},i),song:r},Z.updateSettings)},Z.addInstrument=function(){var e=Z.state.song;if(e.instruments.length>=30)return S.kg.error("You can't add more than 30 instruments!");e.addInstrument(v.BX[0]),Z.setState({song:e}),Z.syncInstruments(e)};var T=(0,s.Z)(Z);Z.removeInstrument=(a=(0,r.Z)(function(e){var t,n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:if(n=(t=T.state).song,(s=t.layers).length<=1)return[2,S.kg.warn("You can't remove all layers!")];return[4,(0,eb.jH)("Are you sure you want to remove ".concat(s[e].name,"? ALL NOTES OF THIS LAYER WILL BE DELETED"))];case 1:return r.sent()&&(n.removeInstrument(e),T.syncInstruments(n),T.setState({song:n,layer:Math.max(0,e-1)})),[2]}})}),function(e){return a.apply(this,arguments)}),Z.editInstrument=function(e,t){var n=Z.state.song;n.instruments[t]=e.clone(),n.instruments=(0,d.Z)(n.instruments),Z.syncInstruments(n),Z.setState({song:n})};var P=(0,s.Z)(Z);Z.syncInstruments=(h=(0,r.Z)(function(e){var t,n,s;return(0,m.__generator)(this,function(i){switch(i.label){case 0:var o;if(t=P.state.layers,e||(e=P.state.song),t.splice(e.instruments.length).forEach(function(e){eB.n.disconnect(e.endNode),e.dispose()}),n=e.instruments.map((o=(0,r.Z)(function(e,n){var s,r,i;return(0,m.__generator)(this,function(o){switch(o.label){case 0:if(void 0!==t[n])return[3,2];return s=new eI.ZP(e.name),t[n]=s,[4,s.load(eB.n.getAudioContext())];case 1:if(o.sent()||S.kg.error("There was an error loading the instrument"),!P.mounted)return[2,s.dispose()];return eB.n.connect(s.endNode),s.changeVolume(e.volume),[2,s];case 2:if(t[n].name!==e.name)return[3,3];return t[n].changeVolume(e.volume),[2,t[n]];case 3:return r=t[n],eB.n.disconnect(r.endNode),r.dispose(),i=new eI.ZP(e.name),t[n]=i,[4,i.load(eB.n.getAudioContext())];case 4:if(o.sent()||S.kg.error("There was an error loading the instrument"),!P.mounted)return[2,i.dispose()];return eB.n.connect(i.endNode),i.changeVolume(e.volume),[2,i];case 5:return[2]}})}),function(e,t){return o.apply(this,arguments)})),!P.mounted)return[2];return[4,Promise.all(n)];case 1:return s=i.sent(),P.setState({layers:s}),[2]}})}),function(e){return h.apply(this,arguments)}),Z.changeVolume=function(e){var t=Z.state.settings,n=Number(e.key.split("layer")[1])-1;t[e.key]=(0,c.Z)((0,l.Z)({},t[e.key]),{volume:e.value}),Z.state.layers[n].changeVolume(e.value),Z.setState({settings:(0,l.Z)({},t)},Z.updateSettings)};var A=(0,s.Z)(Z);Z.startRecordingAudio=(g=(0,r.Z)(function(e){var t,n;return(0,m.__generator)(this,function(s){switch(s.label){case 0:if(!A.mounted)return[2];if(!e)return A.setState({isRecordingAudio:!1}),[2,A.togglePlay(!1)];return eB.n.startRecording(),A.setState({isRecordingAudio:!0}),[4,(0,C.gw)(300)];case 1:return s.sent(),[4,A.togglePlay(!0)];case 2:if(s.sent(),!A.mounted)return[2];return A.setState({isRecordingAudio:!1}),[4,eB.n.stopRecording()];case 3:if(!(t=s.sent()))return[2];return[4,(0,eb.cJ)("Write the song name, press cancel to ignore")];case 4:return(n=s.sent())&&e_.Z.downloadBlob(t.data,n+".wav"),[2]}})}),function(e){return g.apply(this,arguments)}),Z.playSound=function(e,t){var n=Z.state.layers[e],s=null==n?void 0:n.notes[t];if(void 0!==s&&!Z.state.song.instruments[e].muted){var r=Z.state.song.instruments[e].pitch||Z.state.settings.pitch.value;n.play(s.index,r)}},Z.changePitch=function(e){var t=Z.state.settings;t.pitch=(0,c.Z)((0,l.Z)({},t.pitch),{value:e}),Z.setState({settings:(0,l.Z)({},t)},Z.updateSettings)},Z.handleClick=function(e){var t=Z.state,n=t.song,s=t.layer,r=n.selectedColumn,i=r.getNoteIndex(e.index);if(null===i)r.addNote(e.index).setLayer(s,!0);else{var o=r.notes[i];o.toggleLayer(s),o.layer.isEmpty()&&r.removeAtIndex(i)}Z.setState({song:n}),Z.handleAutoSave(),Z.playSound(s,e.index)};var L=(0,s.Z)(Z);Z.renameSong=(f=(0,r.Z)(function(e,t){var n;return(0,m.__generator)(this,function(s){switch(s.label){case 0:return n=L.state.song,[4,ew.k.renameSong(t,e)];case 1:return s.sent(),L.state.song.id===t&&(n.name=e,L.setState({song:n})),[2]}})}),function(e,t){return f.apply(this,arguments)}),Z.addSong=(p=(0,r.Z)(function(e){var t;return(0,m.__generator)(this,function(n){switch(n.label){case 0:return[4,ew.k.addSong(e)];case 1:return t=n.sent(),e.id=t,[2,e]}})}),function(e){return p.apply(this,arguments)});var I=(0,s.Z)(Z);Z.updateSong=(x=(0,r.Z)(function(e){var t;return(0,m.__generator)(this,function(n){switch(n.label){case 0:if("Untitled"!==e.name)return[3,3];return[4,(0,eb.cJ)("Write song name, press cancel to ignore")];case 1:if(null===(t=n.sent())||!I.mounted)return[2,!1];return e.name=t,I.changes=0,I.setState({}),[4,I.addSong(e)];case 2:return n.sent(),[2,!0];case 3:var s;return[2,new Promise((s=(0,r.Z)(function(t){var n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:return[4,eR.v.getSongById(e.id)];case 1:if(!(n=r.sent()))return[3,3];return e.folderId=n.folderId,[4,ew.k.updateSong(e)];case 2:return r.sent(),console.log("song saved:",e.name),I.changes=0,I.setState({}),[3,6];case 3:if(!e.name.includes("- Composed"))return[3,5];return[4,(0,eb.cJ)("Write the song name for the composed version, press cancel to ignore")];case 4:if(null===(s=r.sent()))return[2,t(!1)];return e.name=s,I.addSong(e),[2,t(!0)];case 5:console.log("song doesn't exist"),e.name="Untitled",I.updateSong(e),r.label=6;case 6:return t(!0),[2]}})}),function(e){return s.apply(this,arguments)}))]}})}),function(e){return x.apply(this,arguments)});var _=(0,s.Z)(Z);Z.updateThisSong=(0,r.Z)(function(){return(0,m.__generator)(this,function(e){return _.updateSong(_.state.song),[2]})});var E=(0,s.Z)(Z);Z.askForSongUpdate=(0,r.Z)(function(){return(0,m.__generator)(this,function(e){switch(e.label){case 0:return[4,(0,eb.jH)('You have unsaved changes to the song: "'.concat(E.state.song.name,'" do you want to save now?'),!1)];case 1:return[2,e.sent()]}})});var M=(0,s.Z)(Z);Z.createNewSong=(0,r.Z)(function(){var e,t,n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:if(!("Untitled"!==M.state.song.name&&M.changes>0))return[3,3];return[4,M.askForSongUpdate()];case 1:if(null===(e=r.sent()))return[2];if(!e)return[3,3];return[4,M.updateSong(M.state.song)];case 2:r.sent(),r.label=3;case 3:return[4,(0,eb.cJ)("Write song name, press cancel to ignore")];case 4:if(null===(t=r.sent())||(n=new k.l(t,[v.BX[0],v.BX[0],v.BX[0]]),M.changes=0,!M.mounted))return[2];return[4,M.addSong(n)];case 5:if(s=r.sent(),!M.mounted)return[2];return M.setState({song:s,layer:0}),ev.Z.songEvent({type:"create"}),[2]}})});var B=(0,s.Z)(Z);Z.loadSong=(y=(0,r.Z)(function(e){var t,n,s,r,i;return(0,m.__generator)(this,function(o){switch(o.label){case 0:if(t=B.state,n=null,e instanceof k.l?n=e:("recorded"===e.type&&(n=eT.M.deserialize(e).toComposedSong(4),n.name+=" - Composed"),"composed"===e.type&&(n=k.l.deserialize(e))),!n)return[2];if(!(0!==B.changes))return[3,4];if(!(!(s=t.settings.autosave.value&&"Untitled"!==t.song.name)&&t.song.columns.length>0))return[3,2];return[4,(0,eb.jH)('You have unsaved changes to the song: "'.concat(t.song.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1)];case 1:if(null===(r=o.sent()))return[2];s=r,o.label=2;case 2:if(!s)return[3,4];return[4,B.updateSong(t.song)];case 3:if(o.sent(),t.song.name===n.name)return[2];o.label=4;case 4:if((i=B.state.settings).bpm=(0,c.Z)((0,l.Z)({},i.bpm),{value:e.bpm}),i.pitch=(0,c.Z)((0,l.Z)({},i.pitch),{value:e.pitch}),!B.mounted)return[2];return B.changes=0,console.log("song loaded"),B.setState({layer:0,song:n,settings:(0,l.Z)({},i),selectedColumns:[]},function(){return B.syncInstruments()}),[2]}})}),function(e){return y.apply(this,arguments)}),Z.addColumns=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end";return new Promise(function(n){var s=Z.state.song;s.addColumns(e,t),1===e&&Z.selectColumn(s.selected+1),Z.handleAutoSave(),Z.setState({song:s},n)})},Z.removeColumns=function(e,t){var n=Z.state,s=n.song,r=n.settings;s.columns.length<4*r.beatMarks.value||(s.removeColumns(e,t),s.columns.length<=s.selected&&Z.selectColumn(s.selected-1),Z.handleAutoSave(),Z.setState({song:s}))};var O=(0,s.Z)(Z);Z.togglePlay=(b=(0,r.Z)(function(e){return(0,m.__generator)(this,function(t){return[2,new Promise(function(t){var n="boolean"==typeof e?e:!O.state.isPlaying;O.setState({isPlaying:n},(0,r.Z)(function(){var e,n,s,r,i,o,a;return(0,m.__generator)(this,function(l){switch(l.label){case 0:O.state.isPlaying&&O.selectColumn(O.state.song.selected),e=0,n=Date.now(),l.label=1;case 1:if(!O.state.isPlaying)return[3,3];return r=(s=O.state).song,i=s.settings,o=r.selectedColumn.getTempoChanger().changer,a=Math.floor(6e4/i.bpm.value*o)+e,n=Date.now(),[4,(0,C.gw)(a)];case 2:if(l.sent(),!O.state.isPlaying||!O.mounted)return[3,3];return O.handleTick(),e=n+a-Date.now(),[3,1];case 3:return t(),[2]}})}))})]})}),function(e){return b.apply(this,arguments)}),Z.handleTick=function(){var e=Z.state.song.selected+1;if(Z.state.isPlaying&&e>Z.state.song.columns.length-1)return Z.togglePlay(!1);Z.selectColumn(e)},Z.toggleBreakpoint=function(e){var t=Z.state.song;t.toggleBreakpoint(e),Z.validateBreakpoints(),Z.setState({song:t})},Z.handleTempoChanger=function(e){var t=Z.state,n=t.song,s=t.selectedColumns;s.length?(Z.addToHistory(),s.forEach(function(t){var s;null===(s=n.columns[t])||void 0===s||s.setTempoChanger(e)})):n.selectedColumn.setTempoChanger(e),Z.handleAutoSave(),Z.setState({song:n})};var H=(0,s.Z)(Z);Z.changePage=(j=(0,r.Z)(function(e){var t,n,s;return(0,m.__generator)(this,function(r){switch(r.label){case 0:if(n=(t=H.state).song,s=t.settings,"Home"===e)return[2,eE.I.open()];if(!(0!==H.changes))return[3,5];if(!s.autosave.value)return[3,2];return[4,H.updateSong(n)];case 1:return r.sent(),[3,5];case 2:return[4,(0,eb.jH)('You have unsaved changes to the song: "'.concat(n.name,'" do you want to save? UNSAVED CHANGES WILL BE LOST'),!1)];case 3:if(!r.sent())return[3,5];return[4,H.updateSong(n)];case 4:if(!r.sent())return[2,console.log("Blocking redirect")];r.label=5;case 5:return H.props.router.events.off("routeChangeStart",H.unblock),H.props.router.push(e),[2]}})}),function(e){return j.apply(this,arguments)}),Z.selectColumn=function(e,t){var n=Z.state,s=n.song,r=n.isToolsVisible,i=n.layers,o=n.copiedColumns,a=Z.state.selectedColumns;if(!(e<0)&&!(e>s.columns.length-1)){if(s.selected=e,r&&0===o.length){a.push(e);var l,c,u=(l=Math).min.apply(l,(0,d.Z)(a));a=Array((c=Math).max.apply(c,(0,d.Z)(a))-u+1).fill(0).map(function(e,t){return u+t})}Z.setState({song:s,selectedColumns:a}),t||s.selectedColumn.notes.forEach(function(e){i.forEach(function(t,n){e.isLayerToggled(n)&&Z.playSound(n,e.index)})})}},Z.selectColumnFromDirection=function(e){Z.selectColumn(Z.state.song.selected+e)},Z.changeLayer=function(e){Z.setState({layer:e})},Z.toggleTools=function(){Z.setState({isToolsVisible:!Z.state.isToolsVisible,selectedColumns:Z.state.isToolsVisible?[]:[Z.state.song.selected],copiedColumns:[],undoHistory:[]})},Z.resetSelection=function(){Z.setState({copiedColumns:[],selectedColumns:[Z.state.song.selected]})},Z.addToHistory=function(){var e=Z.state,t=e.song,n=e.undoHistory;e.isToolsVisible&&Z.setState({undoHistory:(0,d.Z)(n).concat([t.clone().columns])})},Z.undo=function(){var e=Z.state,t=e.undoHistory,n=e.song,s=t.pop();s&&(n.columns=s,n.selected=n.columns.length>n.selected?n.selected:n.columns.length-1,Z.setState({undoHistory:(0,d.Z)(t),song:n}))},Z.copyColumns=function(e){var t=Z.state,n=t.selectedColumns,s=t.song.copyColumns(n,e);Z.changes++,Z.setState({selectedColumns:[],copiedColumns:s})};var D=(0,s.Z)(Z);Z.pasteColumns=(w=(0,r.Z)(function(e,t){var n,s,r;return(0,m.__generator)(this,function(i){return s=(n=D.state).song,r=n.copiedColumns,D.addToHistory(),"all"===t?s.pasteColumns(r,e):Number.isFinite(t)&&s.pasteLayer(r,e,t),D.syncInstruments(),D.changes++,D.setState({song:s}),[2]})}),function(e,t){return w.apply(this,arguments)}),Z.eraseColumns=function(e){var t=Z.state,n=t.song,s=t.selectedColumns;Z.addToHistory(),n.eraseColumns(s,e),Z.changes++,Z.setState({song:n,selectedColumns:[n.selected]})},Z.moveNotesBy=function(e,t){var n=Z.state,s=n.song,r=n.selectedColumns;Z.addToHistory(),s.moveNotesBy(r,e,t),Z.changes++,Z.setState({song:s})},Z.switchLayerPosition=function(e){var t=Z.state,n=t.song,s=t.layer,r=s+e;if(!(r<0)&&!(r>n.instruments.length-1)){n.swapLayer(n.columns.length,0,s,r);var i=n.instruments[s];n.instruments[s]=n.instruments[r],n.instruments[r]=i,n.instruments=(0,d.Z)(n.instruments),Z.changes++,Z.syncInstruments(),Z.setState({song:n,layer:r})}};var F=(0,s.Z)(Z);Z.deleteColumns=(0,r.Z)(function(){var e,t,n;return(0,m.__generator)(this,function(s){return t=(e=F.state).song,n=e.selectedColumns,F.addToHistory(),t.deleteColumns(n),F.changes++,F.setState({song:t,selectedColumns:[t.selected]},F.validateBreakpoints),[2]})}),Z.validateBreakpoints=function(){var e=Z.state.song;e.validateBreakpoints(),Z.setState({song:e})},Z.changeMidiVisibility=function(e){Z.setState({isMidiVisible:e}),e&&ev.Z.songEvent({type:"create_MIDI"})};var V=eH.j.getDefaultComposerSettings();return Z.state={layers:[new eI.ZP(v.BX[1])],isPlaying:!1,song:new k.l("Untitled",[v.BX[0],v.BX[0],v.BX[0]]),settings:V,layer:0,selectedColumns:[],undoHistory:[],copiedColumns:[],isToolsVisible:!1,isMidiVisible:!1,isRecordingAudio:!1,theme:N.f6},Z.state.song.bpm=V.bpm.value,Z.mounted=!1,Z.changes=0,Z.broadcastChannel=null,Z}var f=n.prototype;return f.componentDidMount=function(){var e=this;this.mounted=!0;var t=eH.j.getComposerSettings();this.setState({settings:t}),this.init(t),this.broadcastChannel=window.BroadcastChannel?new BroadcastChannel(v.iC+"_composer"):null,this.broadcastChannel&&this.broadcastChannel.addEventListener("message",function(t){e.state.settings.syncTabs.value&&["play","stop"].includes(null==t?void 0:t.data)&&e.togglePlay("play"===t.data)}),this.unblock=function(t){if(0!==e.changes)throw e.changePage(t),e.props.router.events.emit("routeChangeError"),"routeChange aborted.";e.props.router.events.off("routeChangeStart",e.unblock),e.props.router.push(t)},this.props.router.events.on("routeChangeStart",this.unblock),"localhost"!==window.location.hostname&&window.addEventListener("beforeunload",this.handleUnload)},f.componentWillUnmount=function(){var e,t,n=this.state,s=n.layers;this.mounted=!1,eB.n.clear(),s.forEach(function(e){return e.dispose()}),null===(e=this.broadcastChannel)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),n.isPlaying=!1,this.props.router.events.off("routeChangeStart",this.unblock),eu.w.unregisterById("composer"),eM.mP.removeListener(this.handleMidi),eB.n.isRecording&&eB.n.stopRecording(),"localhost"!==window.location.hostname&&window.removeEventListener("beforeunload",this.handleUnload)},f.render=function(){var e,t=this,n=this.state,s=n.isMidiVisible,r=n.song,i=n.isPlaying,o=n.copiedColumns,a=n.settings,l=n.isRecordingAudio,c=n.isToolsVisible,u=n.layer,d=n.selectedColumns,h=n.layers,m=n.undoHistory,f=(0,C.wU)(r.columns,a.bpm.value,r.selected);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(eU.D,{text:"Composer - ".concat(r.name)}),s&&(0,g.jsx)(O,{functions:this,data:{instruments:r.instruments,selectedColumn:r.selected}}),(0,g.jsxs)("div",{className:"composer-grid",children:[(0,g.jsxs)("div",{className:"column composer-left-control",children:[(0,g.jsx)(H.J,{className:"flex-centered",style:{height:"3rem",borderRadius:"0.3rem",backgroundColor:"var(--primary-darken-10)"},onClick:function(e){if(t.togglePlay(),a.syncTabs.value){var n,s;null===(n=t.broadcastChannel)||void 0===n||null===(s=n.postMessage)||void 0===s||s.call(n,i?"stop":"play")}},ariaLabel:i?"Pause":"Play",children:(0,g.jsx)(ec.Z,{children:i?(0,g.jsx)(p.Wh,{size:18,color:"var(--icon-color)"},"pause"):(0,g.jsx)(p.gmG,{size:18,color:"var(--icon-color)"},"play")})}),(0,g.jsx)(eW,{instruments:r.instruments,selected:u,onLayerSelect:this.changeLayer,onInstrumentAdd:this.addInstrument,onInstrumentChange:this.editInstrument,onInstrumentDelete:this.removeInstrument,onChangePosition:this.switchLayerPosition})]}),(0,g.jsx)("div",{className:"top-panel-composer",style:{gridArea:"b"},children:(0,g.jsxs)("div",{className:"row",style:{height:"fit-content",width:"100%"},children:[(0,g.jsx)(em,{functions:this,data:{inPreview:this.props.inPreview,isRecordingAudio:l,currentLayer:u,isPlaying:i,song:r,settings:a,selectedColumns:d,columns:r.columns,selected:r.selected,breakpoints:r.breakpoints}},a.columnsPerCanvas.value),(0,g.jsxs)("div",{className:"buttons-composer-wrapper-right",children:[(0,g.jsx)(eO,{onClick:function(){return t.addColumns(1,r.selected)},tooltip:"Add column",ariaLabel:"Add column",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(x,{className:"tool-icon"})})}),(0,g.jsx)(eO,{onClick:function(){return t.removeColumns(1,r.selected)},tooltip:"Remove column",ariaLabel:"Remove column",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(y,{className:"tool-icon"})})}),(0,g.jsx)(eO,{onClick:function(){return t.addColumns(4*Number(a.beatMarks.value),"end")},tooltip:"Add new page",ariaLabel:"Add new page",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.wEH,{size:16})})}),(0,g.jsx)(eO,{onClick:this.toggleTools,tooltip:"Open tools",ariaLabel:"Open tools",children:(0,g.jsx)(ec.Z,{children:(0,g.jsx)(p.CP_,{size:16})})})]})]})}),(0,g.jsx)(G,{functions:this,data:{isPlaying:i,settings:a,isRecordingAudio:l,currentLayer:u,instruments:r.instruments,keyboard:h[u],currentColumn:r.selectedColumn,pitch:(null===(e=r.instruments[u])||void 0===e?void 0:e.pitch)||a.pitch.value,noteNameType:a.noteNameType.value}})]}),(0,g.jsx)(eL,{data:{isRecordingAudio:l,settings:a,hasChanges:this.changes>0},functions:this}),(0,g.jsx)(z,{data:{isToolsVisible:c,layer:u,hasCopiedColumns:o.length>0,selectedColumns:d,undoHistory:m},functions:this}),(0,g.jsxs)("div",{className:"song-info",children:[(0,g.jsx)("div",{className:"text-ellipsis",children:r.name}),(0,g.jsxs)("div",{children:[(0,C.dH)(f.current),"/",(0,C.dH)(f.total)]})]})]})},(0,o.Z)(n,[{key:"currentInstrument",get:function(){return this.state.layers[this.state.layer]}}]),n}(f.Component);function eG(e){var t,n=e.inPreview,s=e.songId,r=(0,eX.useRouter)(),i=r.query.songId;return(0,g.jsx)(eY,{router:r,songId:null!==(t=null!=i?i:s)&&void 0!==t?t:null,inPreview:null!=n&&n})}}}]);